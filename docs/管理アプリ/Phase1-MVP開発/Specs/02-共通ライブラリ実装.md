# æ©Ÿèƒ½ä»•æ§˜æ›¸: å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªå®Ÿè£…

## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæƒ…å ±
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
- **ä½œæˆæ—¥**: 2026-02-01
- **å¯¾è±¡ãƒ•ã‚§ãƒ¼ã‚º**: Phase1-MVPé–‹ç™º
- **é–¢é€£ã‚¿ã‚¹ã‚¯**: [02-å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªå®Ÿè£…](../02-å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªå®Ÿè£….md)

---

## 1. ãƒ“ã‚¸ãƒã‚¹ç›®çš„

### 1.1 ãªãœå¿…è¦ã‹

æœ¬ã‚¿ã‚¹ã‚¯ã¯ã€å…¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆ8ã¤ã®ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ï¼‰ã§**å…±é€šåˆ©ç”¨ã™ã‚‹åŸºç›¤æ©Ÿèƒ½**ã‚’æä¾›ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å®Ÿè£…ã—ã¾ã™ã€‚å„ã‚µãƒ¼ãƒ“ã‚¹ãŒå€‹åˆ¥ã«èªè¨¼ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã€ãƒ­ã‚®ãƒ³ã‚°ãªã©ã‚’å®Ÿè£…ã™ã‚‹ã¨ã€é–‹ç™ºã‚³ã‚¹ãƒˆãŒå¢—å¤§ã—ã€å“è³ªã®ã°ã‚‰ã¤ããŒç”Ÿã˜ã¾ã™ã€‚å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚ˆã‚Šã€ã“ã‚Œã‚‰ã®åŸºç›¤æ©Ÿèƒ½ã‚’ä¸€å…ƒåŒ–ã—ã€é–‹ç™ºåŠ¹ç‡ã¨ã‚³ãƒ¼ãƒ‰å“è³ªã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚

### 1.2 ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤

| ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤ | èª¬æ˜ | å®šé‡çš„åŠ¹æœ |
|------------|------|----------|
| **é–‹ç™ºé€Ÿåº¦ã®å‘ä¸Š** | å„ã‚µãƒ¼ãƒ“ã‚¹ã§èªè¨¼ãƒ»DBã‚¢ã‚¯ã‚»ã‚¹ã‚’å†å®Ÿè£…ã›ãšã€å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§é–‹ç™ºæ™‚é–“ã‚’çŸ­ç¸® | å„ã‚µãƒ¼ãƒ“ã‚¹ã®é–‹ç™ºæ™‚é–“ã‚’**30-40%å‰Šæ¸›** |
| **å“è³ªã®å‡ä¸€åŒ–** | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€ãƒ­ã‚®ãƒ³ã‚°ãŒå…¨ã‚µãƒ¼ãƒ“ã‚¹ã§çµ±ä¸€ã•ã‚Œã€ãƒã‚°ã¨è„†å¼±æ€§ãŒæ¸›å°‘ | ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚é–“ã‚’**50%å‰Šæ¸›**ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ã‚’**70%ä½æ¸›** |
| **ä¿å®ˆæ€§ã®å‘ä¸Š** | å…±é€šæ©Ÿèƒ½ã®ä¿®æ­£ãŒ1ç®‡æ‰€ã§å®Œçµã—ã€å…¨ã‚µãƒ¼ãƒ“ã‚¹ã«å³åº§ã«åæ˜ ã•ã‚Œã‚‹ | ãƒã‚°ä¿®æ­£æ™‚é–“ã‚’**60%å‰Šæ¸›** |
| **å­¦ç¿’ã‚³ã‚¹ãƒˆã®å‰Šæ¸›** | æ–°è¦é–‹ç™ºè€…ãŒå…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å­¦ã¹ã°ã€å…¨ã‚µãƒ¼ãƒ“ã‚¹ã®é–‹ç™ºãŒå¯èƒ½ | ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æœŸé–“ã‚’**2é€±é–“çŸ­ç¸®** |
| **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Š** | å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«é›†ä¸­ã—ã¦ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã™ã‚‹ã“ã¨ã§ã€å…¨ä½“ã®å“è³ªãŒå‘ä¸Š | ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**80%ä»¥ä¸Š**ã‚’ä¿è¨¼ |

### 1.3 ãƒ“ã‚¸ãƒã‚¹ä¸Šã®å‰ææ¡ä»¶

- **å¯¾è±¡**: å…¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆèªè¨¼ã€ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†ã€ã‚µãƒ¼ãƒ“ã‚¹è¨­å®šã€4ã¤ã®ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒ“ã‚¹ã€Frontend BFFï¼‰
- **æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯çµ±ä¸€**: å…¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒPython 3.11 + FastAPIã§é–‹ç™ºã•ã‚Œã‚‹ã“ã¨ãŒå‰æ
- **ã‚¤ãƒ³ãƒ•ãƒ©æ§‹ç¯‰å®Œäº†**: Cosmos DBã€App ServiceãŒåˆ©ç”¨å¯èƒ½ã§ã‚ã‚‹ã“ã¨ï¼ˆã‚¿ã‚¹ã‚¯01ä¾å­˜ï¼‰
- **MVPå„ªå…ˆ**: Phase1ã§ã¯æœ€å°é™ã®æ©Ÿèƒ½ã‚»ãƒƒãƒˆã«çµã‚Šã€Phase2ã§æ‹¡å¼µ

---

## 2. æ©Ÿèƒ½è¦ä»¶ï¼ˆç°¡æ½”ç‰ˆï¼‰

### 2.1 æä¾›ã™ã‚‹æ©Ÿèƒ½ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

#### 2.1.1 èªè¨¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆcommon.authï¼‰
- **èª¬æ˜**: JWTãƒ™ãƒ¼ã‚¹ã®èªè¨¼æ©Ÿèƒ½ã‚’æä¾›ã—ã€å…¨ã‚µãƒ¼ãƒ“ã‚¹ã§çµ±ä¸€çš„ãªèªè¨¼å‡¦ç†ã‚’å®Ÿç¾
- **ãƒ“ã‚¸ãƒã‚¹è²¢çŒ®**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ä¸€è²«æ€§ã‚’ä¿è¨¼ã—ã€èªè¨¼é–¢é€£ã®è„†å¼±æ€§ã‚’ä¸€å…ƒç®¡ç†
- **ä¸»è¦æ©Ÿèƒ½**:
  - JWTç”Ÿæˆãƒ»æ¤œè¨¼ãƒ»ãƒ‡ã‚³ãƒ¼ãƒ‰
  - èªè¨¼Middlewareï¼ˆFastAPIçµ±åˆï¼‰
  - ä¾å­˜æ³¨å…¥ç”¨ãƒ˜ãƒ«ãƒ‘ãƒ¼ï¼ˆ`get_current_user`ï¼‰
  - ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹èªå¯ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ï¼ˆ`require_role`ï¼‰

#### 2.1.2 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆcommon.databaseï¼‰
- **èª¬æ˜**: Cosmos DBæ¥ç¶šã¨CRUDæ“ä½œã®åŸºç›¤ã‚’æä¾›
- **ãƒ“ã‚¸ãƒã‚¹è²¢çŒ®**: ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’çµ±ä¸€ã—ã€é–‹ç™ºé€Ÿåº¦ã¨ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã‚’å‘ä¸Š
- **ä¸»è¦æ©Ÿèƒ½**:
  - Cosmos DBéåŒæœŸæ¥ç¶šç®¡ç†ï¼ˆã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ï¼‰
  - åŸºåº•Repositoryã‚¯ãƒ©ã‚¹ï¼ˆæ±ç”¨CRUDæ“ä½œï¼‰
  - ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ¼ãƒ«æœ€é©åŒ–
  - ã‚¯ã‚¨ãƒªå®Ÿè¡Œãƒ˜ãƒ«ãƒ‘ãƒ¼ï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒªï¼‰

#### 2.1.3 ãƒ­ã‚®ãƒ³ã‚°ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆcommon.loggingï¼‰
- **èª¬æ˜**: æ§‹é€ åŒ–ãƒ­ã‚°ï¼ˆJSONå½¢å¼ï¼‰ã®å‡ºåŠ›ã¨Application Insightsçµ±åˆ
- **ãƒ“ã‚¸ãƒã‚¹è²¢çŒ®**: å•é¡Œã®æ—©æœŸç™ºè¦‹ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ™‚é–“ã®çŸ­ç¸®
- **ä¸»è¦æ©Ÿèƒ½**:
  - JSONãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ï¼ˆtimestamp, level, message, moduleç­‰ï¼‰
  - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã®ãƒ­ã‚¬ãƒ¼è¨­å®š
  - ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®è‡ªå‹•è¿½åŠ ï¼ˆuser_id, tenant_id, request_idï¼‰
  - Application Insightsçµ±åˆ

#### 2.1.4 ãƒ¢ãƒ‡ãƒ«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆcommon.modelsï¼‰
- **èª¬æ˜**: å…¨ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®åŸºåº•Pydanticãƒ¢ãƒ‡ãƒ«ã¨æ¨™æº–ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹
- **ãƒ“ã‚¸ãƒã‚¹è²¢çŒ®**: ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ä¸€è²«æ€§ã‚’ä¿è¨¼ã—ã€APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’çµ±ä¸€
- **ä¸»è¦æ©Ÿèƒ½**:
  - åŸºåº•BaseModelï¼ˆid, created_at, updated_atè‡ªå‹•è¨­å®šï¼‰
  - æ¨™æº–ErrorResponseãƒ¢ãƒ‡ãƒ«
  - JSONå¤‰æ›ãƒ«ãƒ¼ãƒ«ã®çµ±ä¸€

#### 2.1.5 ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆcommon.middlewareï¼‰
- **èª¬æ˜**: FastAPIãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®å…±é€šå®Ÿè£…
- **ãƒ“ã‚¸ãƒã‚¹è²¢çŒ®**: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆè¿½è·¡ã®è‡ªå‹•åŒ–ã«ã‚ˆã‚Šã€é‹ç”¨å“è³ªãŒå‘ä¸Š
- **ä¸»è¦æ©Ÿèƒ½**:
  - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°Middlewareï¼ˆå…¨ä¾‹å¤–ã‚’æ¨™æº–ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§è¿”å´ï¼‰
  - ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDMiddlewareï¼ˆX-Request-IDã®ç”Ÿæˆã¨ä»˜ä¸ï¼‰
  - CORSè¨­å®šãƒ˜ãƒ«ãƒ‘ãƒ¼

#### 2.1.6 ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆcommon.utilsï¼‰
- **èª¬æ˜**: æ±ç”¨çš„ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ã¨ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
- **ãƒ“ã‚¸ãƒã‚¹è²¢çŒ®**: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã®å†åˆ©ç”¨ã«ã‚ˆã‚Šã€å…¥åŠ›æ¤œè¨¼ã®æŠœã‘æ¼ã‚Œã‚’é˜²æ­¢
- **ä¸»è¦æ©Ÿèƒ½**:
  - ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼ï¼ˆemail, password, tenant_id, uuidï¼‰
  - ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ï¼ˆIDç”Ÿæˆã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–ã€æ©Ÿå¯†æƒ…å ±ãƒã‚¹ã‚­ãƒ³ã‚°ï¼‰

### 2.2 ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹æˆ

```
src/common/
â”œâ”€â”€ common/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ auth/              # èªè¨¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ jwt.py
â”‚   â”‚   â”œâ”€â”€ middleware.py
â”‚   â”‚   â””â”€â”€ dependencies.py
â”‚   â”œâ”€â”€ database/          # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ cosmos.py
â”‚   â”‚   â””â”€â”€ repository.py
â”‚   â”œâ”€â”€ logging/           # ãƒ­ã‚®ãƒ³ã‚°ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ formatter.py
â”‚   â”‚   â””â”€â”€ logger.py
â”‚   â”œâ”€â”€ models/            # ãƒ¢ãƒ‡ãƒ«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py
â”‚   â”‚   â””â”€â”€ errors.py
â”‚   â”œâ”€â”€ middleware/        # ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ cors.py
â”‚   â”‚   â”œâ”€â”€ error_handler.py
â”‚   â”‚   â””â”€â”€ request_id.py
â”‚   â””â”€â”€ utils/             # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ validators.py
â”‚       â””â”€â”€ helpers.py
â”œâ”€â”€ tests/                 # ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ test_auth.py
â”‚   â”œâ”€â”€ test_database.py
â”‚   â”œâ”€â”€ test_logging.py
â”‚   â””â”€â”€ test_validators.py
â”œâ”€â”€ setup.py              # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°è¨­å®š
â”œâ”€â”€ requirements.txt      # ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
â””â”€â”€ README.md            # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
```

---

## 3. API/ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ä»•æ§˜

### 3.1 èªè¨¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆcommon.authï¼‰

#### 3.1.1 JWTå‡¦ç†ï¼ˆjwt.pyï¼‰

```python
def create_access_token(data: dict, expires_delta: Optional[timedelta] = None) -> str:
    """
    JWTã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆ
    
    Args:
        data: ãƒˆãƒ¼ã‚¯ãƒ³ã«å«ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ï¼ˆuser_id, tenant_id, rolesç­‰ï¼‰
              - å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: user_id, tenant_id
        expires_delta: æœ‰åŠ¹æœŸé™ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 60åˆ†ï¼‰
    
    Returns:
        str: ç½²åæ¸ˆã¿JWTãƒˆãƒ¼ã‚¯ãƒ³
    
    Raises:
        ValueError: dataãŒç©ºã€ã¾ãŸã¯å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰(user_id, tenant_id)ãŒæ¬ è½ã—ã¦ã„ã‚‹å ´åˆ
        JWTError: JWTç½²åã«å¤±æ•—ã—ãŸå ´åˆ
        
    Error Handling:
        - ç™ºç”Ÿã—ãŸä¾‹å¤–ã¯ãƒ­ã‚®ãƒ³ã‚°ã•ã‚Œã€ä¸Šä½ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ä¼æ’­
        - ãƒªãƒˆãƒ©ã‚¤ã¯è¡Œã‚ãªã„ï¼ˆå†ªç­‰æ€§ãŒä¿è¨¼ã•ã‚Œãªã„ãŸã‚ï¼‰
    
    Business Value:
        - ã‚»ã‚­ãƒ¥ã‚¢ãªèªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œã«ã‚ˆã‚Šã€ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã‚’é˜²æ­¢
        - æœ‰åŠ¹æœŸé™ç®¡ç†ã«ã‚ˆã‚Šã€ãƒˆãƒ¼ã‚¯ãƒ³æ¼æ´©æ™‚ã®å½±éŸ¿ã‚’æœ€å°åŒ–
    """

def decode_access_token(token: str) -> dict:
    """
    JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œè¨¼ã—ã¦ãƒ‡ã‚³ãƒ¼ãƒ‰
    
    Args:
        token: æ¤œè¨¼ã™ã‚‹JWTãƒˆãƒ¼ã‚¯ãƒ³
    
    Returns:
        dict: ãƒ‡ã‚³ãƒ¼ãƒ‰æ¸ˆã¿ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ï¼ˆuser_id, tenant_id, rolesç­‰ï¼‰
    
    Raises:
        HTTPException(401): ãƒˆãƒ¼ã‚¯ãƒ³ãŒç„¡åŠ¹ã€æœŸé™åˆ‡ã‚Œã€ã¾ãŸã¯ç½²åæ¤œè¨¼å¤±æ•—ã®å ´åˆ
        ValueError: tokenãŒç©ºæ–‡å­—åˆ—ã¾ãŸã¯Noneã®å ´åˆ
        
    Error Handling:
        - ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼å¤±æ•—ã¯å¿…ãš401ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦è¿”å´
        - è©³ç´°ãªã‚¨ãƒ©ãƒ¼æƒ…å ±ã¯ãƒ­ã‚°ã«è¨˜éŒ²ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³æœ¬ä½“ã¯è¨˜éŒ²ã—ãªã„ï¼‰
    
    Business Value:
        - ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ã®ä¸€å…ƒåŒ–ã«ã‚ˆã‚Šã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ›ãƒ¼ãƒ«ã‚’é˜²æ­¢
        - çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ã‚ˆã‚Šã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå®Ÿè£…ãŒå®¹æ˜“
    """
```

#### 3.1.2 èªè¨¼Middlewareï¼ˆmiddleware.pyï¼‰

```python
class JWTAuthenticationMiddleware:
    """
    FastAPI Middleware for JWT authentication
    
    Functionality:
        - Authorizationãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³æŠ½å‡º
        - ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼
        - request.state.user ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±è¨­å®š
        - èªè¨¼å¤±æ•—æ™‚ã¯ 401 ã‚¨ãƒ©ãƒ¼
    
    Business Value:
        - å…¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§è‡ªå‹•çš„ã«èªè¨¼ãƒã‚§ãƒƒã‚¯ãŒå®Ÿè¡Œã•ã‚Œã€æ‰‹å‹•å®Ÿè£…ã®æ¼ã‚Œã‚’é˜²æ­¢
        - èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã®å¤‰æ›´ãŒå…¨ã‚µãƒ¼ãƒ“ã‚¹ã«å³åº§ã«åæ˜ 
    """
```

#### 3.1.3 ä¾å­˜æ³¨å…¥ãƒ˜ãƒ«ãƒ‘ãƒ¼ï¼ˆdependencies.pyï¼‰

```python
async def get_current_user(request: Request) -> User:
    """
    FastAPI Dependencyã§ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—
    
    Usage:
        @router.get("/profile")
        async def get_profile(current_user: User = Depends(get_current_user)):
            return current_user
    
    Business Value:
        - ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã”ã¨ã«èªè¨¼å‡¦ç†ã‚’è¨˜è¿°ã™ã‚‹å¿…è¦ãŒãªãã€é–‹ç™ºé€Ÿåº¦ãŒå‘ä¸Š
    """

def require_role(service_id: str, required_roles: List[str]):
    """
    ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹èªå¯ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿
    
    Args:
        service_id: ã‚µãƒ¼ãƒ“ã‚¹IDï¼ˆ"tenant-management"ç­‰ï¼‰
        required_roles: å¿…è¦ãªãƒ­ãƒ¼ãƒ«ä¸€è¦§ï¼ˆ["ç®¡ç†è€…", "å…¨ä½“ç®¡ç†è€…"]ç­‰ï¼‰
    
    Usage:
        @router.post("/tenants")
        @require_role("tenant-management", ["ç®¡ç†è€…"])
        async def create_tenant(current_user: User = Depends(get_current_user)):
            pass
    
    Business Value:
        - æ¨©é™ãƒã‚§ãƒƒã‚¯ã®å®Ÿè£…ãƒŸã‚¹ã‚’é˜²æ­¢ã—ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å¼·åŒ–
        - æ¨©é™è¦ä»¶ãŒæ˜ç¤ºçš„ã«ãªã‚Šã€ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå®¹æ˜“
    """
```

### 3.2 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆcommon.databaseï¼‰

#### 3.2.1 Cosmos DBæ¥ç¶šï¼ˆcosmos.pyï¼‰

```python
class CosmosDBClient:
    """
    Cosmos DBæ¥ç¶šç®¡ç†ï¼ˆã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
    
    Features:
        - éåŒæœŸæ¥ç¶šãƒ—ãƒ¼ãƒ«ã®ç®¡ç†
        - è¤‡æ•°ã‚³ãƒ³ãƒ†ãƒŠã¸ã®ã‚¢ã‚¯ã‚»ã‚¹
        - è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ï¼ˆæŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ï¼‰
    
    Usage:
        client = CosmosDBClient.get_instance()
        container = client.get_container("tenant")
    
    Retry Policy:
        - 429 (RUä¸è¶³): æœ€å¤§3å›ãƒªãƒˆãƒ©ã‚¤ã€æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ï¼ˆåˆå›1ç§’ã€2å›ç›®2ç§’ã€3å›ç›®4ç§’ï¼‰
        - 503 (ã‚µãƒ¼ãƒ“ã‚¹ä¸€æ™‚åœæ­¢): æœ€å¤§3å›ãƒªãƒˆãƒ©ã‚¤ã€æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•
        - 408 (ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ): æœ€å¤§2å›ãƒªãƒˆãƒ©ã‚¤ã€1ç§’é–“éš”
        - ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼: ãƒªãƒˆãƒ©ã‚¤ãªã—ã€å³åº§ã«ä¾‹å¤–ä¼æ’­
    
    Timeout Settings:
        - æ¥ç¶šç¢ºç«‹: 5ç§’
        - èª­ã¿å–ã‚Šæ“ä½œ: 2ç§’
        - æ›¸ãè¾¼ã¿æ“ä½œ: 5ç§’
    
    Error Handling:
        - CosmosHttpResponseError: Cosmos DBå›ºæœ‰ã®ã‚¨ãƒ©ãƒ¼ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰å«ã‚€ï¼‰
        - TimeoutError: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚ï¼ˆãƒªãƒˆãƒ©ã‚¤å¾Œã‚‚å¤±æ•—ï¼‰
        - ConnectionError: æ¥ç¶šç¢ºç«‹å¤±æ•—ï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éšœå®³ç­‰ï¼‰
    
    Business Value:
        - æ¥ç¶šç®¡ç†ã®ä¸€å…ƒåŒ–ã«ã‚ˆã‚Šã€ãƒªã‚½ãƒ¼ã‚¹ãƒªãƒ¼ã‚¯ã‚’é˜²æ­¢
        - ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½ã«ã‚ˆã‚Šã€ä¸€æ™‚çš„ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éšœå®³ã«å¯¾ã™ã‚‹è€æ€§ã‚’å‘ä¸Š
        - æ˜ç¢ºãªã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã«ã‚ˆã‚Šãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’ä¿è­·
    """
```

#### 3.2.2 åŸºåº•Repositoryã‚¯ãƒ©ã‚¹ï¼ˆrepository.pyï¼‰

```python
class BaseRepository(Generic[T]):
    """
    CRUDæ“ä½œã®å…±é€šå®Ÿè£…ï¼ˆãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢å¼·åˆ¶ï¼‰
    
    Type Parameter:
        T: Pydanticãƒ¢ãƒ‡ãƒ«ã®å‹
    
    Security:
        - å…¨ã¦ã®ã‚¯ã‚¨ãƒªã§ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ï¼ˆtenant_idï¼‰ã‚’å¼·åˆ¶
        - ã‚¯ãƒ­ã‚¹ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚¯ã‚¨ãƒªã¯æ˜ç¤ºçš„ãª allow_cross_partition=True ãŒå¿…è¦
        - ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ã®æŒ‡å®šæ¼ã‚Œã¯ ValueError ã‚’ç™ºç”Ÿ
        - ã‚¯ã‚¨ãƒªå†…ã«ãƒ†ãƒŠãƒ³ãƒˆIDãƒ•ã‚£ãƒ«ã‚¿ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹è‡ªå‹•æ¤œè¨¼
    
    Methods:
        - get(id, partition_key): å˜ä¸€ã‚¢ã‚¤ãƒ†ãƒ å–å¾—
        - create(item): ã‚¢ã‚¤ãƒ†ãƒ ä½œæˆ
        - update(id, partition_key, data): ã‚¢ã‚¤ãƒ†ãƒ æ›´æ–°
        - delete(id, partition_key): ã‚¢ã‚¤ãƒ†ãƒ å‰Šé™¤
        - query(query, parameters, partition_key, allow_cross_partition): ã‚¯ã‚¨ãƒªå®Ÿè¡Œ
        - list_by_partition(partition_key, limit, continuation_token): ä¸€è¦§å–å¾—
    
    Business Value:
        - CRUDæ“ä½œã®å®Ÿè£…æ™‚é–“ã‚’80%å‰Šæ¸›
        - ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ã®æŒ‡å®šæ¼ã‚Œã‚’é˜²æ­¢ã—ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æœ€é©åŒ–
        - ç¶™ç¶šãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã—ãŸãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚Šã€å¤§é‡ãƒ‡ãƒ¼ã‚¿ã«å¯¾å¿œ
        - ãƒ†ãƒŠãƒ³ãƒˆæ¨ªæ–­ã‚¢ã‚¯ã‚»ã‚¹ã‚’é˜²æ­¢ã—ã€ãƒ‡ãƒ¼ã‚¿æ¼æ´©ãƒªã‚¹ã‚¯ã‚’æœ€å°åŒ–
    """
    
    async def get(self, id: str, partition_key: str) -> Optional[T]:
        """
        å˜ä¸€ã‚¢ã‚¤ãƒ†ãƒ å–å¾—
        
        Args:
            id: ã‚¢ã‚¤ãƒ†ãƒ ID
            partition_key: ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ï¼ˆtenant_idï¼‰
        
        Returns:
            Optional[T]: ã‚¢ã‚¤ãƒ†ãƒ ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯ãƒ¢ãƒ‡ãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã€å­˜åœ¨ã—ãªã„å ´åˆã¯None
        
        Raises:
            ValueError: idã¾ãŸã¯partition_keyãŒç©ºæ–‡å­—åˆ—ã¾ãŸã¯Noneã®å ´åˆ
            CosmosHttpResponseError: Cosmos DBã‚¨ãƒ©ãƒ¼ï¼ˆãƒªãƒˆãƒ©ã‚¤å¾Œã‚‚å¤±æ•—ï¼‰
            TimeoutError: èª­ã¿å–ã‚Šã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ2ç§’è¶…éï¼‰
        
        Retry Policy:
            - 429 (RUä¸è¶³): æœ€å¤§3å›ã€æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•
            - 503 (ã‚µãƒ¼ãƒ“ã‚¹ä¸€æ™‚åœæ­¢): æœ€å¤§3å›ã€æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•
            - ãã®ä»–ã‚¨ãƒ©ãƒ¼: ãƒªãƒˆãƒ©ã‚¤ãªã—
        
        Performance:
            - ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚­ãƒ¼æŒ‡å®šã«ã‚ˆã‚Šã€å˜ä¸€ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚¯ã‚¨ãƒªï¼ˆ< 50msï¼‰
        """
    
    async def query(
        self,
        query: str,
        parameters: List[Dict[str, Any]],
        partition_key: Optional[str] = None,
        allow_cross_partition: bool = False
    ) -> List[T]:
        """
        ã‚¯ã‚¨ãƒªå®Ÿè¡Œï¼ˆãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢å¼·åˆ¶ï¼‰
        
        Args:
            query: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã•ã‚ŒãŸSQLã‚¯ã‚¨ãƒª
            parameters: ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆ[{"name": "@tenant_id", "value": "..."}]å½¢å¼ï¼‰
            partition_key: ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ï¼ˆNoneã®å ´åˆã€allow_cross_partition=TrueãŒå¿…é ˆï¼‰
            allow_cross_partition: ã‚¯ãƒ­ã‚¹ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚¯ã‚¨ãƒªã‚’è¨±å¯ã™ã‚‹ã‹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: Falseï¼‰
        
        Returns:
            List[T]: ã‚¯ã‚¨ãƒªçµæœã®ãƒ¢ãƒ‡ãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒªã‚¹ãƒˆ
        
        Raises:
            ValueError: partition_keyãŒNoneã§ã€allow_cross_partition=Falseã®å ´åˆ
            SecurityError: ã‚¯ã‚¨ãƒªã«ãƒ†ãƒŠãƒ³ãƒˆIDãƒ•ã‚£ãƒ«ã‚¿ï¼ˆc.tenantId = @tenant_idï¼‰ãŒå«ã¾ã‚Œãªã„å ´åˆ
            SecurityError: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«@tenant_idãŒå«ã¾ã‚Œã¦ã„ãªã„å ´åˆ
            CosmosHttpResponseError: Cosmos DBã‚¨ãƒ©ãƒ¼ï¼ˆãƒªãƒˆãƒ©ã‚¤å¾Œã‚‚å¤±æ•—ï¼‰
            TimeoutError: ã‚¯ã‚¨ãƒªã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ2ç§’è¶…éï¼‰
        
        Security Check:
            1. partition_keyã¨allow_cross_partitionã®æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
            2. ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ã« "c.tenantId = @tenant_id" ã¾ãŸã¯ "c.tenant_id = @tenant_id" ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹æ¤œè¨¼
            3. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«@tenant_idã¾ãŸã¯@tenantIdãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹æ¤œè¨¼
            4. æ¤œè¨¼å¤±æ•—æ™‚ã¯SecurityErrorã‚’ç™ºç”Ÿï¼ˆé‹ç”¨ãƒãƒ¼ãƒ ã«ã‚¢ãƒ©ãƒ¼ãƒˆï¼‰
        
        Implementation Example:
            ```python
            # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
            if partition_key is None and not allow_cross_partition:
                raise ValueError(
                    "partition_key is required for tenant isolation. "
                    "Use allow_cross_partition=True to explicitly allow cross-partition queries."
                )
            
            # ã‚¯ã‚¨ãƒªã«ãƒ†ãƒŠãƒ³ãƒˆIDãƒ•ã‚£ãƒ«ã‚¿ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹æ¤œè¨¼
            if "c.tenantId" not in query and "c.tenant_id" not in query:
                logger.error(
                    "Security violation: Query without tenant_id filter",
                    extra={"query": query, "stack_trace": traceback.format_stack()}
                )
                raise SecurityError(
                    "Query must include tenant_id filter (c.tenantId = @tenant_id) for data isolation"
                )
            
            # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«tenant_idãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹æ¤œè¨¼
            tenant_id_in_params = any(
                p.get("name") in ("@tenant_id", "@tenantId") 
                for p in parameters
            )
            if not tenant_id_in_params:
                logger.error(
                    "Security violation: Query parameters without tenant_id",
                    extra={"parameters": parameters}
                )
                raise SecurityError(
                    "Query parameters must include @tenant_id for data isolation"
                )
            ```
        
        Business Value:
            - ãƒ†ãƒŠãƒ³ãƒˆæ¨ªæ–­ã‚¢ã‚¯ã‚»ã‚¹ã‚’æŠ€è¡“çš„ã«é˜²æ­¢ã—ã€ãƒ‡ãƒ¼ã‚¿æ¼æ´©ãƒªã‚¹ã‚¯ã‚’æœ€å°åŒ–
            - é–‹ç™ºè€…ãŒã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒŸã‚¹ã‚’ã—ã¦ã‚‚ã€å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªå±¤ã§è‡ªå‹•æ¤œå‡º
            - ç›£æŸ»ãƒ­ã‚°ã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é•åã‚’è¨˜éŒ²ã—ã€ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã«å¯¾å¿œ
        """
```

**ä½¿ç”¨ä¾‹**:
```python
# ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªãƒã‚¸ãƒˆãƒªã®å®Ÿè£…
class UserRepository(BaseRepository[User]):
    def __init__(self, container):
        super().__init__(container, User)
    
    async def find_by_email(self, tenant_id: str, email: str) -> Optional[User]:
        query = "SELECT * FROM c WHERE c.tenantId = @tenant_id AND c.email = @email"
        parameters = [
            {"name": "@tenant_id", "value": tenant_id},
            {"name": "@email", "value": email}
        ]
        results = await self.query(query, parameters, partition_key=tenant_id)
        return results[0] if results else None
```

### 3.3 ãƒ­ã‚®ãƒ³ã‚°ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆcommon.loggingï¼‰

#### 3.3.1 JSONãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ï¼ˆformatter.pyï¼‰

```python
class JSONFormatter(logging.Formatter):
    """
    æ§‹é€ åŒ–ãƒ­ã‚°ã®JSONå‡ºåŠ›
    
    Output Format:
        {
            "timestamp": "2026-02-01T12:00:00Z",
            "level": "INFO",
            "logger": "auth-service",
            "message": "User logged in",
            "module": "auth",
            "function": "login",
            "user_id": "user_123",
            "tenant_id": "tenant_456",
            "request_id": "req_abc"
        }
    
    Business Value:
        - Application Insightsã§ã‚¯ã‚¨ãƒªå¯èƒ½ãªæ§‹é€ åŒ–ãƒ­ã‚°
        - ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ™‚é–“ã‚’60%çŸ­ç¸®
        - ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDã«ã‚ˆã‚‹åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ãŒå¯èƒ½
    """
```

#### 3.3.2 ãƒ­ã‚¬ãƒ¼è¨­å®šï¼ˆlogger.pyï¼‰

```python
def setup_logging(app_name: str, log_level: str = "INFO") -> logging.Logger:
    """
    ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã®ãƒ­ã‚¬ãƒ¼è¨­å®š
    
    Args:
        app_name: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å
        log_level: ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ï¼ˆDEBUG/INFO/WARNING/ERROR/CRITICALï¼‰
    
    Returns:
        logging.Logger: è¨­å®šæ¸ˆã¿ãƒ­ã‚¬ãƒ¼
    
    Business Value:
        - å…¨ã‚µãƒ¼ãƒ“ã‚¹ã§çµ±ä¸€ã•ã‚ŒãŸãƒ­ã‚°å½¢å¼ã«ã‚ˆã‚Šã€é‹ç”¨åŠ¹ç‡ãŒå‘ä¸Š
        - ç’°å¢ƒå¤‰æ•°ã§ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«åˆ¶å¾¡å¯èƒ½ï¼ˆæœ¬ç•ªã§ã¯INFOã€é–‹ç™ºã§ã¯DEBUGï¼‰
    """

def get_logger(name: str) -> logging.Logger:
    """
    ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ¥ãƒ­ã‚¬ãƒ¼å–å¾—
    
    Usage:
        logger = get_logger(__name__)
        logger.info("Processing request", extra={"user_id": user.id})
    
    Business Value:
        - ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å˜ä½ã§ãƒ­ã‚°ã‚’çµã‚Šè¾¼ã¿å¯èƒ½
    """
```

### 3.4 ãƒ¢ãƒ‡ãƒ«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆcommon.modelsï¼‰

#### 3.4.1 åŸºåº•ãƒ¢ãƒ‡ãƒ«ï¼ˆbase.pyï¼‰

```python
class BaseModel(pydantic.BaseModel):
    """
    å…¨ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®åŸºåº•ã‚¯ãƒ©ã‚¹
    
    Fields:
        - id: ãƒ¦ãƒ‹ãƒ¼ã‚¯IDï¼ˆUUIDè‡ªå‹•ç”Ÿæˆï¼‰
        - created_at: ä½œæˆæ—¥æ™‚ï¼ˆè‡ªå‹•è¨­å®šï¼‰
        - updated_at: æ›´æ–°æ—¥æ™‚ï¼ˆè‡ªå‹•è¨­å®šï¼‰
    
    Features:
        - datetimeã®ISO 8601å½¢å¼å¤‰æ›
        - JSONå¤‰æ›ã®çµ±ä¸€
    
    Business Value:
        - å…¨ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã§ä¸€è²«ã—ãŸIDç”Ÿæˆã¨ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ç®¡ç†
        - ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã®å‘ä¸Š
    """
```

#### 3.4.2 ã‚¨ãƒ©ãƒ¼ãƒ¢ãƒ‡ãƒ«ï¼ˆerrors.pyï¼‰

```python
class ErrorResponse(BaseModel):
    """
    æ¨™æº–åŒ–ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹
    
    Fields:
        - code: ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ï¼ˆ"TENANT_NOT_FOUND"ç­‰ï¼‰
        - message: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        - details: è©³ç´°æƒ…å ±ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼‰
        - timestamp: ç™ºç”Ÿæ—¥æ™‚
        - request_id: ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDï¼ˆãƒˆãƒ¬ãƒ¼ã‚¹ç”¨ï¼‰
    
    Business Value:
        - APIã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒå…¨ã‚µãƒ¼ãƒ“ã‚¹ã§çµ±ä¸€
        - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒå®¹æ˜“
        - request_idã«ã‚ˆã‚‹ã‚¨ãƒ©ãƒ¼è¿½è·¡ãŒå¯èƒ½
    """
```

### 3.5 ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆcommon.middlewareï¼‰

#### 3.5.1 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆerror_handler.pyï¼‰

```python
class ErrorHandlerMiddleware:
    """
    å…¨ã¦ã®ä¾‹å¤–ã‚’æ¨™æº–ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§è¿”å´
    
    Handled Exceptions:
        - HTTPException: FastAPIã®æ¨™æº–HTTPã‚¨ãƒ©ãƒ¼
        - ValidationError: Pydanticãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
        - Exception: äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ï¼ˆ500ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦è¿”å´ï¼‰
    
    Features:
        - ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®è‡ªå‹•è¨˜éŒ²
        - ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã®å‡ºåŠ›ï¼ˆé–‹ç™ºç’°å¢ƒã®ã¿ï¼‰
        - æ¨™æº–ErrorResponseå½¢å¼ã§ã®è¿”å´
    
    Business Value:
        - äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ã§ã‚‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ä¸€è²«ã—ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹
        - ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®èª¿æŸ»æ™‚é–“ã‚’çŸ­ç¸®
    """
```

#### 3.5.2 ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDç”Ÿæˆï¼ˆrequest_id.pyï¼‰

```python
class RequestIDMiddleware:
    """
    å„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ä¸€æ„ã®IDã‚’ä»˜ä¸
    
    Functionality:
        - X-Request-IDãƒ˜ãƒƒãƒ€ãƒ¼ã®ç”Ÿæˆ
        - request.state.request_id ã«è¨­å®š
        - ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã«ä»˜ä¸
    
    Business Value:
        - åˆ†æ•£ã‚·ã‚¹ãƒ†ãƒ ã§ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆè¿½è·¡ãŒå¯èƒ½
        - ãƒ­ã‚°åˆ†ææ™‚ã«ç‰¹å®šãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å…¨ãƒ­ã‚°ã‚’æŠ½å‡ºå¯èƒ½
    """
```

### 3.6 ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆcommon.utilsï¼‰

#### 3.6.1 ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼ï¼ˆvalidators.pyï¼‰

```python
def validate_email(email: str) -> bool:
    """ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³"""

def validate_password_strength(password: str) -> bool:
    """
    ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¼·åº¦ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    
    Requirements:
        - æœ€å°12æ–‡å­—
        - å¤§æ–‡å­—ã€å°æ–‡å­—ã€æ•°å­—ã€ç‰¹æ®Šæ–‡å­—ã‚’å„1æ–‡å­—ä»¥ä¸Šå«ã‚€
    
    Business Value:
        - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã®çµ±ä¸€
        - å¼±ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¾µå®³ã‚’é˜²æ­¢
    """

def validate_tenant_id_format(tenant_id: str) -> bool:
    """ãƒ†ãƒŠãƒ³ãƒˆIDå½¢å¼ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ"tenant_" + è­˜åˆ¥å­ï¼‰"""

def validate_uuid(value: str) -> bool:
    """UUIDå½¢å¼ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³"""
```

#### 3.6.2 ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ï¼ˆhelpers.pyï¼‰

```python
def generate_id(prefix: str) -> str:
    """
    ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ä»˜ãIDç”Ÿæˆ
    
    Example:
        generate_id("user_")  # => "user_550e8400-e29b-41d4-a716-446655440000"
    
    Business Value:
        - IDã®å¯èª­æ€§å‘ä¸Šï¼ˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚¿ã‚¤ãƒ—ãŒä¸€ç›®ã§ã‚ã‹ã‚‹ï¼‰
    """

def hash_password(password: str) -> str:
    """
    ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’bcryptã§ãƒãƒƒã‚·ãƒ¥åŒ–ï¼ˆcost factor: 12ï¼‰
    
    Business Value:
        - ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¿å­˜
        - ãƒãƒƒã‚·ãƒ¥ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®çµ±ä¸€
    """

def verify_password(password: str, hashed: str) -> bool:
    """ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼"""

def mask_sensitive_data(text: str) -> str:
    """
    ãƒ­ã‚°å‡ºåŠ›æ™‚ã®æ©Ÿå¯†æƒ…å ±ãƒã‚¹ã‚­ãƒ³ã‚°
    
    Masked Data:
        - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
        - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆä¸€éƒ¨ï¼‰
        - ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ç•ªå·
    
    Business Value:
        - ãƒ­ã‚°çµŒç”±ã®æ©Ÿå¯†æƒ…å ±æ¼æ´©ã‚’é˜²æ­¢
    """
```

---

## 4. éæ©Ÿèƒ½è¦ä»¶

### 4.1 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶

| é …ç›® | è¦ä»¶ | ãƒ“ã‚¸ãƒã‚¹ä¸Šã®ç†ç”± |
|-----|------|---------------|
| **JWTç”Ÿæˆãƒ»æ¤œè¨¼** | 1msä»¥å†… | å…¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€é«˜é€Ÿã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ |
| **Cosmos DBæ¥ç¶šç¢ºç«‹** | åˆå›100msä»¥å†…ã€2å›ç›®ä»¥é™10msä»¥å†… | æ¥ç¶šãƒ—ãƒ¼ãƒ«ã«ã‚ˆã‚Šå†åˆ©ç”¨ã™ã‚‹ãŸã‚ã€2å›ç›®ä»¥é™ã¯é«˜é€Ÿ |
| **Base Repository CRUD** | å˜ä¸€ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚¯ã‚¨ãƒª: 50msä»¥å†… | ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã«ç›´çµã™ã‚‹ãŸã‚ã€é«˜é€Ÿãªãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãŒå¿…è¦ |
| **ãƒ­ã‚°å‡ºåŠ›** | åŒæœŸå‡¦ç†5msä»¥å†…ã€éåŒæœŸå‡¦ç†æ¨å¥¨ | ãƒ­ã‚°å‡ºåŠ›ãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ€§èƒ½ã®ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã«ãªã‚‰ãªã„ |

### 4.2 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶

| é …ç›® | è¦ä»¶ | ãƒ“ã‚¸ãƒã‚¹ä¸Šã®ç†ç”± |
|-----|------|---------------|
| **JWTç§˜å¯†éµç®¡ç†** | ç’°å¢ƒå¤‰æ•°ï¼ˆPhase1ï¼‰ã€Azure Key Vaultï¼ˆPhase2ï¼‰ | ç§˜å¯†éµæ¼æ´©ã«ã‚ˆã‚‹å…¨ã‚·ã‚¹ãƒ†ãƒ ä¾µå®³ã‚’é˜²æ­¢ |
| **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–** | bcrypt, cost factor 12 | ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«æ”»æ’ƒã«å¯¾ã™ã‚‹è€æ€§ |
| **ãƒ­ã‚°å†…æ©Ÿå¯†æƒ…å ±** | è‡ªå‹•ãƒã‚¹ã‚­ãƒ³ã‚°å¿…é ˆ | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€ãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒ­ã‚°æ¼æ´©é˜²æ­¢ |
| **ãƒ†ãƒŠãƒ³ãƒˆæ¨ªæ–­ã‚¢ã‚¯ã‚»ã‚¹é˜²æ­¢** | BaseRepositoryå±¤ã§è‡ªå‹•æ¤œè¨¼ï¼ˆã‚¯ã‚¨ãƒªå†…ãƒ†ãƒŠãƒ³ãƒˆIDãƒ•ã‚£ãƒ«ã‚¿å¿…é ˆï¼‰ | ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã§æœ€ã‚‚ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ |
| **SQL/NoSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³** | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒªå¿…é ˆ | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¾µå®³ã®é˜²æ­¢ |
| **ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸** | å®šæœŸçš„ãªè„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ | æ—¢çŸ¥ã®è„†å¼±æ€§ã«ã‚ˆã‚‹æ”»æ’ƒã‚’é˜²æ­¢ |

### 4.3 ä¿å®ˆæ€§è¦ä»¶

| é …ç›® | è¦ä»¶ | ãƒ“ã‚¸ãƒã‚¹ä¸Šã®ç†ç”± |
|-----|------|---------------|
| **ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸** | 80%ä»¥ä¸Š | ååˆ†ãªãƒ†ã‚¹ãƒˆã«ã‚ˆã‚Šãƒã‚°ã‚’æ—©æœŸç™ºè¦‹ |
| **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ** | å…¨å…¬é–‹é–¢æ•°ã«docstring | é–‹ç™ºè€…ã®å­¦ç¿’ã‚³ã‚¹ãƒˆã‚’å‰Šæ¸› |
| **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®‰å®šæ€§** | Phase1æœŸé–“ä¸­ã¯ç ´å£Šçš„å¤‰æ›´ãªã— | å¾Œç¶šã‚¿ã‚¹ã‚¯ã¸ã®å½±éŸ¿ã‚’æœ€å°åŒ– |
| **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸** | æ˜ç¢ºã§å®Ÿç”¨çš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ™‚é–“ã®çŸ­ç¸® |

### 4.4 å¯æ¬æ€§è¦ä»¶

| é …ç›® | è¦ä»¶ | ãƒ“ã‚¸ãƒã‚¹ä¸Šã®ç†ç”± |
|-----|------|---------------|
| **Python ãƒãƒ¼ã‚¸ãƒ§ãƒ³** | 3.11ä»¥ä¸Š | æœ€æ–°ã®è¨€èªæ©Ÿèƒ½ã¨æ€§èƒ½æ”¹å–„ã‚’æ´»ç”¨ |
| **ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸** | æœ€å°é™ã«æŠ‘ãˆã‚‹ | ä¾å­˜é–¢ä¿‚ã®è¤‡é›‘åŒ–ã‚’é¿ã‘ã‚‹ |
| **è¨­å®šã®å¤–éƒ¨åŒ–** | ç’°å¢ƒå¤‰æ•°ã§åˆ¶å¾¡ | ç’°å¢ƒã”ã¨ã®è¨­å®šå¤‰æ›´ãŒå®¹æ˜“ |

### 4.5 æ‹¡å¼µæ€§è¦ä»¶

| é …ç›® | è¦ä»¶ | ãƒ“ã‚¸ãƒã‚¹ä¸Šã®ç†ç”± |
|-----|------|---------------|
| **ãƒ—ãƒ©ã‚¬ãƒ–ãƒ«è¨­è¨ˆ** | å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ç‹¬ç«‹ã—ã¦ä½¿ç”¨å¯èƒ½ | å¿…è¦ãªæ©Ÿèƒ½ã®ã¿ã‚’é¸æŠçš„ã«ä½¿ç”¨ |
| **ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½** | è¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§å‹•ä½œã‚’å¤‰æ›´å¯èƒ½ | ã‚µãƒ¼ãƒ“ã‚¹å›ºæœ‰ã®è¦ä»¶ã«å¯¾å¿œ |
| **Phase2æ©Ÿèƒ½ã®è¿½åŠ å®¹æ˜“æ€§** | ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã€ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ç­‰ã®è¿½åŠ ãŒå®¹æ˜“ | å°†æ¥ã®æ©Ÿèƒ½è¿½åŠ ã«å¯¾å¿œ |

---

## 5. ãƒ†ã‚¹ãƒˆè¦ä»¶

### 5.1 ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

#### 5.1.1 å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆUnit Testï¼‰
- **å¯¾è±¡**: å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®é–¢æ•°ãƒ»ã‚¯ãƒ©ã‚¹
- **ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™**: 80%ä»¥ä¸Š
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: pytest
- **å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°**: ã‚³ãƒŸãƒƒãƒˆå‰ã€CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

#### 5.1.2 çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆIntegration Testï¼‰
- **å¯¾è±¡**: Cosmos DBæ¥ç¶šã€JWTæ¤œè¨¼ã€ãƒ­ã‚¬ãƒ¼å‡ºåŠ›
- **ç’°å¢ƒ**: Cosmos DB Emulatorä½¿ç”¨
- **å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°**: CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

#### 5.1.3 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
- **å¯¾è±¡**: JWTç”Ÿæˆ/æ¤œè¨¼ã€DBæ¥ç¶šã€CRUDæ“ä½œ
- **åŸºæº–**: 4.1 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶ã‚’æº€ãŸã™ã“ã¨

### 5.2 ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä¾‹

#### 5.2.1 èªè¨¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆtest_auth.pyï¼‰
```python
def test_create_access_token():
    """JWTãƒˆãƒ¼ã‚¯ãƒ³ç”ŸæˆãŒæˆåŠŸã™ã‚‹ã“ã¨"""

def test_decode_valid_token():
    """æœ‰åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³ãŒãƒ‡ã‚³ãƒ¼ãƒ‰ã§ãã‚‹ã“ã¨"""

def test_decode_expired_token():
    """æœŸé™åˆ‡ã‚Œãƒˆãƒ¼ã‚¯ãƒ³ã§HTTPException(401)ãŒç™ºç”Ÿã™ã‚‹ã“ã¨"""

def test_require_role_authorized():
    """æ­£ã—ã„ãƒ­ãƒ¼ãƒ«ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªã“ã¨"""

def test_require_role_unauthorized():
    """ãƒ­ãƒ¼ãƒ«ãŒãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§HTTPException(403)ãŒç™ºç”Ÿã™ã‚‹ã“ã¨"""
```

#### 5.2.2 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆtest_database.pyï¼‰
```python
def test_cosmos_client_singleton():
    """CosmosDBClientãŒã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã§ã‚ã‚‹ã“ã¨"""

def test_base_repository_create():
    """BaseRepository.createã§ã‚¢ã‚¤ãƒ†ãƒ ãŒä½œæˆã•ã‚Œã‚‹ã“ã¨"""

def test_base_repository_get():
    """BaseRepository.getã§ã‚¢ã‚¤ãƒ†ãƒ ãŒå–å¾—ã§ãã‚‹ã“ã¨"""

def test_base_repository_query_with_partition_key():
    """ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚­ãƒ¼æŒ‡å®šã®ã‚¯ã‚¨ãƒªãŒé«˜é€Ÿã«å®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨"""
```

#### 5.2.3 ãƒ­ã‚®ãƒ³ã‚°ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆtest_logging.pyï¼‰
```python
def test_json_formatter_output():
    """JSONãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ãŒJSONå½¢å¼ã§å‡ºåŠ›ã™ã‚‹ã“ã¨"""

def test_logger_context_injection():
    """ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒãƒ­ã‚°ã«è‡ªå‹•è¿½åŠ ã•ã‚Œã‚‹ã“ã¨"""

def test_mask_sensitive_data():
    """æ©Ÿå¯†æƒ…å ±ãŒãƒã‚¹ã‚­ãƒ³ã‚°ã•ã‚Œã‚‹ã“ã¨"""
```

#### 5.2.4 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆï¼ˆtest_security.pyï¼‰
```python
def test_tenant_isolation_query_without_partition_key():
    """ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ãªã—ã‚¯ã‚¨ãƒªã§ValueErrorãŒç™ºç”Ÿã™ã‚‹ã“ã¨"""
    repository = UserRepository(container)
    with pytest.raises(ValueError, match="partition_key is required"):
        await repository.query(
            "SELECT * FROM c WHERE c.email = @email",
            [{"name": "@email", "value": "test@example.com"}],
            partition_key=None,
            allow_cross_partition=False
        )

def test_tenant_isolation_query_without_tenant_filter():
    """ãƒ†ãƒŠãƒ³ãƒˆIDãƒ•ã‚£ãƒ«ã‚¿ãªã—ã‚¯ã‚¨ãƒªã§SecurityErrorãŒç™ºç”Ÿã™ã‚‹ã“ã¨"""
    repository = UserRepository(container)
    with pytest.raises(SecurityError, match="must include tenant_id filter"):
        await repository.query(
            "SELECT * FROM c WHERE c.email = @email",  # c.tenantIdãƒ•ã‚£ãƒ«ã‚¿ãªã—
            [{"name": "@email", "value": "test@example.com"}],
            partition_key="tenant_1"
        )

def test_tenant_isolation_query_without_tenant_parameter():
    """@tenant_idãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãªã—ã‚¯ã‚¨ãƒªã§SecurityErrorãŒç™ºç”Ÿã™ã‚‹ã“ã¨"""
    repository = UserRepository(container)
    with pytest.raises(SecurityError, match="must include @tenant_id"):
        await repository.query(
            "SELECT * FROM c WHERE c.tenantId = @tenant_id AND c.email = @email",
            [{"name": "@email", "value": "test@example.com"}],  # @tenant_idãªã—
            partition_key="tenant_1"
        )

def test_tenant_isolation_cross_tenant_access_blocked():
    """ç•°ãªã‚‹ãƒ†ãƒŠãƒ³ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã“ã¨"""
    repository = UserRepository(container)
    # tenant_1ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãŒã€tenant_2ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¦æ±‚
    with pytest.raises(HTTPException) as exc:
        await repository.get(
            item_id="user_from_tenant_2",
            partition_key="tenant_2"  # æœ¬æ¥ã¯tenant_1ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
        )
    assert exc.value.status_code == 403
    assert "tenant" in exc.value.detail.lower()

def test_sql_injection_prevention():
    """SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãŒé˜²æ­¢ã•ã‚Œã‚‹ã“ã¨"""
    repository = UserRepository(container)
    malicious_input = "'; DROP TABLE users; --"
    # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒªã«ã‚ˆã‚Šå®‰å…¨ã«å‡¦ç†ã•ã‚Œã‚‹
    result = await repository.query(
        "SELECT * FROM c WHERE c.tenantId = @tenant_id AND c.name = @name",
        [
            {"name": "@tenant_id", "value": "tenant_1"},
            {"name": "@name", "value": malicious_input}
        ],
        partition_key="tenant_1"
    )
    # ã‚¨ãƒ©ãƒ¼ã§ã¯ãªãã€å˜ã«çµæœãŒ0ä»¶ï¼ˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãŒç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ï¼‰
    assert len(result) == 0

def test_password_not_in_logs(capsys):
    """ãƒ­ã‚°ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œãªã„ã“ã¨"""
    logger = get_logger(__name__)
    logger.info("User authentication", extra={
        "username": "test_user",
        "password": "secret123",  # æ©Ÿå¯†æƒ…å ±
        "api_key": "sk_live_abc123"  # æ©Ÿå¯†æƒ…å ±
    })
    # ãƒ­ã‚°å‡ºåŠ›ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¦æ¤œè¨¼
    log_output = capsys.readouterr().out
    assert "secret123" not in log_output
    assert "sk_live_abc123" not in log_output
    assert "***MASKED***" in log_output

def test_jwt_token_not_in_logs(capsys):
    """ãƒ­ã‚°ã«JWTãƒˆãƒ¼ã‚¯ãƒ³ãŒå«ã¾ã‚Œãªã„ã“ã¨"""
    logger = get_logger(__name__)
    token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
    logger.info("Token validation", extra={"token": token})
    log_output = capsys.readouterr().out
    assert token not in log_output
    assert "***MASKED***" in log_output
```

#### 5.2.5 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆï¼ˆtest_error_handling.pyï¼‰
```python
def test_cosmos_db_connection_timeout():
    """Cosmos DBæ¥ç¶šã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒé©åˆ‡ã«å‡¦ç†ã•ã‚Œã‚‹ã“ã¨"""
    repository = UserRepository(container)
    with pytest.raises(TimeoutError):
        await asyncio.wait_for(
            repository.get("user_123", "tenant_1"),
            timeout=0.001  # æ„å›³çš„ã«çŸ­ã„ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
        )

def test_cosmos_db_rate_limit_retry(mock_container):
    """RUä¸è¶³æ™‚ã«è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ã•ã‚Œã‚‹ã“ã¨"""
    repository = UserRepository(mock_container)
    # 429ã‚¨ãƒ©ãƒ¼ã‚’2å›è¿”ã—ãŸå¾Œã€3å›ç›®ã§æˆåŠŸ
    mock_container.query_items.side_effect = [
        CosmosHttpResponseError(status_code=429, message="Request rate too large"),
        CosmosHttpResponseError(status_code=429, message="Request rate too large"),
        [{"id": "user_1", "tenantId": "tenant_1"}]  # 3å›ç›®ã§æˆåŠŸ
    ]
    result = await repository.query(
        "SELECT * FROM c WHERE c.tenantId = @tenant_id",
        [{"name": "@tenant_id", "value": "tenant_1"}],
        partition_key="tenant_1"
    )
    assert len(result) == 1
    assert mock_container.query_items.call_count == 3  # 3å›è©¦è¡Œ

def test_cosmos_db_service_unavailable_retry(mock_container):
    """ã‚µãƒ¼ãƒ“ã‚¹ä¸€æ™‚åœæ­¢æ™‚ã«è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ã•ã‚Œã‚‹ã“ã¨"""
    repository = UserRepository(mock_container)
    mock_container.query_items.side_effect = [
        CosmosHttpResponseError(status_code=503, message="Service temporarily unavailable"),
        [{"id": "user_1"}]  # 2å›ç›®ã§æˆåŠŸ
    ]
    result = await repository.query(
        "SELECT * FROM c WHERE c.tenantId = @tenant_id",
        [{"name": "@tenant_id", "value": "tenant_1"}],
        partition_key="tenant_1"
    )
    assert len(result) == 1
    assert mock_container.query_items.call_count == 2

def test_cosmos_db_permanent_error_no_retry(mock_container):
    """æ°¸ç¶šçš„ã‚¨ãƒ©ãƒ¼ï¼ˆ404ç­‰ï¼‰ã¯ãƒªãƒˆãƒ©ã‚¤ã•ã‚Œãªã„ã“ã¨"""
    repository = UserRepository(mock_container)
    mock_container.read_item.side_effect = CosmosHttpResponseError(
        status_code=404,
        message="Item not found"
    )
    result = await repository.get("nonexistent_id", "tenant_1")
    assert result is None
    assert mock_container.read_item.call_count == 1  # ãƒªãƒˆãƒ©ã‚¤ãªã—

def test_jwt_expired_token():
    """æœŸé™åˆ‡ã‚Œãƒˆãƒ¼ã‚¯ãƒ³ã§401ã‚¨ãƒ©ãƒ¼ãŒè¿”ã•ã‚Œã‚‹ã“ã¨"""
    # éå»ã®æ—¥æ™‚ã§æœŸé™åˆ‡ã‚Œãƒˆãƒ¼ã‚¯ãƒ³ä½œæˆ
    expired_token = create_access_token(
        {"user_id": "user_1", "tenant_id": "tenant_1"},
        expires_delta=timedelta(seconds=-10)  # 10ç§’å‰ã«æœŸé™åˆ‡ã‚Œ
    )
    with pytest.raises(HTTPException) as exc:
        decode_access_token(expired_token)
    assert exc.value.status_code == 401
    assert "expired" in exc.value.detail.lower()

def test_jwt_invalid_signature():
    """ç½²åãŒç„¡åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³ã§401ã‚¨ãƒ©ãƒ¼ãŒè¿”ã•ã‚Œã‚‹ã“ã¨"""
    # ç•°ãªã‚‹ç§˜å¯†éµã§ç½²åã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³
    invalid_token = jwt.encode(
        {"user_id": "user_1"},
        "wrong_secret_key",
        algorithm="HS256"
    )
    with pytest.raises(HTTPException) as exc:
        decode_access_token(invalid_token)
    assert exc.value.status_code == 401
    assert "invalid" in exc.value.detail.lower()

def test_base_repository_empty_id():
    """ç©ºã®IDã§ValueErrorãŒç™ºç”Ÿã™ã‚‹ã“ã¨"""
    repository = UserRepository(container)
    with pytest.raises(ValueError, match="id.*empty"):
        await repository.get("", "tenant_1")

def test_base_repository_empty_partition_key():
    """ç©ºã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ã§ValueErrorãŒç™ºç”Ÿã™ã‚‹ã“ã¨"""
    repository = UserRepository(container)
    with pytest.raises(ValueError, match="partition_key.*empty"):
        await repository.get("user_123", "")
```

### 5.3 ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰
```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pytest tests/ --cov=common --cov-report=html

# ç‰¹å®šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã¿
pytest tests/test_auth.py -v

# ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª
open htmlcov/index.html
```

---

## 6. å—ã‘å…¥ã‚ŒåŸºæº–

### 6.1 æ©Ÿèƒ½çš„å—ã‘å…¥ã‚ŒåŸºæº–

- [ ] **ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰æˆåŠŸ**: `python setup.py sdist` ãŒæˆåŠŸã™ã‚‹
- [ ] **å„ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆæˆåŠŸ**: 8ã¤ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ `from common.auth import get_current_user` ãŒå‹•ä½œã™ã‚‹
- [ ] **JWTç”Ÿæˆãƒ»æ¤œè¨¼**: æ­£å¸¸ãªãƒˆãƒ¼ã‚¯ãƒ³ãŒç”Ÿæˆã•ã‚Œã€æ¤œè¨¼ãŒæˆåŠŸã™ã‚‹
- [ ] **Cosmos DBæ¥ç¶š**: BaseRepositoryã‚’ä½¿ç”¨ã—ã¦CRUDæ“ä½œãŒå®Ÿè¡Œã§ãã‚‹
- [ ] **æ§‹é€ åŒ–ãƒ­ã‚°å‡ºåŠ›**: JSONå½¢å¼ã®ãƒ­ã‚°ãŒApplication Insightsã«é€ä¿¡ã•ã‚Œã‚‹
- [ ] **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: å…¨ã¦ã®ä¾‹å¤–ãŒæ¨™æº–ErrorResponseå½¢å¼ã§è¿”å´ã•ã‚Œã‚‹
- [ ] **ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDä»˜ä¸**: å…¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«X-Request-IDãŒä»˜ä¸ã•ã‚Œã‚‹
- [ ] **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‹•ä½œ**: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¼·åº¦ãƒã‚§ãƒƒã‚¯ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹æ¤œè¨¼ãŒæ­£å¸¸å‹•ä½œã™ã‚‹

### 6.2 éæ©Ÿèƒ½çš„å—ã‘å…¥ã‚ŒåŸºæº–

- [ ] **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: JWTç”ŸæˆãŒ1msä»¥å†…ã€CRUDæ“ä½œãŒ50msä»¥å†…
- [ ] **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: 
  - [ ] ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–ã§bcryptï¼ˆcost factor 12ï¼‰ã‚’ä½¿ç”¨
  - [ ] ãƒ­ã‚°ã«æ©Ÿå¯†æƒ…å ±ãŒå«ã¾ã‚Œãªã„
  - [ ] ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒªãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹
- [ ] **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**: 80%ä»¥ä¸Šã‚’é”æˆ
- [ ] **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: README.mdã€å„é–¢æ•°ã®docstringãŒå®Œå‚™

### 6.3 é‹ç”¨çš„å—ã‘å…¥ã‚ŒåŸºæº–

- [ ] **ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†**: requirements.txtãŒä½œæˆã•ã‚Œã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå›ºå®šã•ã‚Œã¦ã„ã‚‹
- [ ] **CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³çµ±åˆ**: GitHub Actionsã§ãƒ†ã‚¹ãƒˆã¨LintãŒè‡ªå‹•å®Ÿè¡Œã•ã‚Œã‚‹
- [ ] **ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°**: å…¨ã¦ã®ä¾‹å¤–ãŒApplication Insightsã«è¨˜éŒ²ã•ã‚Œã‚‹
- [ ] **é–‹ç™ºè€…ã‚¬ã‚¤ãƒ‰**: ä½¿ç”¨æ–¹æ³•ã‚’è¨˜è¼‰ã—ãŸREADME.mdãŒä½œæˆã•ã‚Œã¦ã„ã‚‹

---

## 7. ãƒ“ã‚¸ãƒã‚¹ãƒªã‚¹ã‚¯

### 7.1 ãƒªã‚¹ã‚¯ä¸€è¦§ã¨å¯¾ç­–

| ãƒªã‚¹ã‚¯ | å½±éŸ¿åº¦ | ç™ºç”Ÿç¢ºç‡ | ãƒ“ã‚¸ãƒã‚¹ã¸ã®å½±éŸ¿ | å¯¾ç­– |
|-------|-------|---------|---------------|------|
| **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å¤‰æ›´** | é«˜ | ä¸­ | å¾Œç¶šã‚¿ã‚¹ã‚¯ã§å¤§è¦æ¨¡ãªä¿®æ­£ãŒå¿…è¦ | ãƒ»Phase1æœŸé–“ä¸­ã¯ç ´å£Šçš„å¤‰æ›´ã‚’ç¦æ­¢<br>ãƒ»ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æˆ¦ç•¥ã®ç­–å®š |
| **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œ** | é«˜ | ä½ | ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®ä½ä¸‹ | ãƒ»æ—©æœŸã«ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿæ–½<br>ãƒ»ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ç‰¹å®šã¨æœ€é©åŒ– |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§** | é«˜ | ä¸­ | ãƒ‡ãƒ¼ã‚¿æ¼æ´©ã€ã‚·ã‚¹ãƒ†ãƒ ä¾µå®³ | ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ“ãƒ¥ãƒ¼å¿…é ˆ<br>ãƒ»ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ |
| **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ä¸è¶³** | ä¸­ | ä¸­ | æœ¬ç•ªç’°å¢ƒã§ã®ãƒã‚°ç™ºç”Ÿ | ãƒ»80%ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’å¼·åˆ¶<br>ãƒ»CI/CDã§ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒã‚§ãƒƒã‚¯ |
| **ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è¡çª** | ä¸­ | ä½ | å„ã‚µãƒ¼ãƒ“ã‚¹ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¤±æ•— | ãƒ»æœ€å°é™ã®ä¾å­˜é–¢ä¿‚<br>ãƒ»ãƒãƒ¼ã‚¸ãƒ§ãƒ³å›ºå®š |
| **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸è¶³** | ä¸­ | ä¸­ | é–‹ç™ºè€…ã®å­¦ç¿’ã‚³ã‚¹ãƒˆå¢—å¤§ | ãƒ»docstringå¿…é ˆ<br>ãƒ»README.mdã§ã®ä½¿ç”¨ä¾‹æä¾› |

### 7.2 æƒ³å®šã•ã‚Œã‚‹åˆ¶ç´„

#### 7.2.1 æŠ€è¡“çš„åˆ¶ç´„
- **Python 3.11ä»¥ä¸ŠãŒå¿…é ˆ**: å¤ã„Pythonãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯ã‚µãƒãƒ¼ãƒˆä¸å¯
- **FastAPIä¾å­˜**: ä»–ã®Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆFlaskç­‰ï¼‰ã§ã¯ä½¿ç”¨ä¸å¯
- **Cosmos DBä¾å­˜**: ä»–ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®åˆ‡ã‚Šæ›¿ãˆã«ã¯ä¿®æ­£ãŒå¿…è¦

#### 7.2.2 ãƒ“ã‚¸ãƒã‚¹çš„åˆ¶ç´„
- **MVPå„ªå…ˆ**: Phase1ã§ã¯æœ€å°æ©Ÿèƒ½ã‚»ãƒƒãƒˆã«é™å®šï¼ˆãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã€ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ç­‰ã¯Phase2ï¼‰
- **å¾Œç¶šã‚¿ã‚¹ã‚¯ã¸ã®å½±éŸ¿**: å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå®Œæˆã—ãªã„ã¨ã€å¾Œç¶šã®å…¨ã‚µãƒ¼ãƒ“ã‚¹é–‹ç™ºãŒé–‹å§‹ã§ããªã„

---

## 8. æˆåŠŸã®å®šç¾©

### 8.1 çŸ­æœŸçš„æˆåŠŸæŒ‡æ¨™ï¼ˆPhase1å®Œäº†æ™‚ï¼‰

| æŒ‡æ¨™ | ç›®æ¨™å€¤ | ãƒ“ã‚¸ãƒã‚¹ä¸Šã®æ„å‘³ |
|-----|--------|---------------|
| **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸** | 80%ä»¥ä¸Š | é«˜å“è³ªãªã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ |
| **å„ã‚µãƒ¼ãƒ“ã‚¹ã§ã®æ¡ç”¨ç‡** | 100%ï¼ˆ8ã‚µãƒ¼ãƒ“ã‚¹å…¨ã¦ï¼‰ | å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå®Ÿéš›ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ |
| **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹** | å…¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶ã‚’æº€ãŸã™ | ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã¸ã®æ‚ªå½±éŸ¿ãªã— |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§** | 0ä»¶ï¼ˆCritical/Highï¼‰ | ã‚»ã‚­ãƒ¥ã‚¢ãªã‚·ã‚¹ãƒ†ãƒ  |
| **å¾Œç¶šã‚¿ã‚¹ã‚¯ã®é–‹ç™ºé–‹å§‹é…å»¶** | 0æ—¥ | è¨ˆç”»é€šã‚Šã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé€²è¡Œ |

### 8.2 é•·æœŸçš„æˆåŠŸæŒ‡æ¨™ï¼ˆPhase2ä»¥é™ï¼‰

| æŒ‡æ¨™ | ç›®æ¨™å€¤ | ãƒ“ã‚¸ãƒã‚¹ä¸Šã®æ„å‘³ |
|-----|--------|---------------|
| **å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªèµ·å› ã®ãƒã‚°** | æœˆ1ä»¶ä»¥ä¸‹ | é–‹ç™ºåŠ¹ç‡ã®ç¶­æŒ |
| **æ–°æ©Ÿèƒ½è¿½åŠ æ™‚ã®å½±éŸ¿ç¯„å›²** | å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¿®æ­£ã§ã‚µãƒ¼ãƒ“ã‚¹å´ä¿®æ­£ä¸è¦ | ä¿å®ˆã‚³ã‚¹ãƒˆã®å‰Šæ¸› |
| **æ–°è¦é–‹ç™ºè€…ã®ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°** | å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªå­¦ç¿’ã§2é€±é–“çŸ­ç¸® | äººçš„ã‚³ã‚¹ãƒˆã®å‰Šæ¸› |

---

## 9. åˆ¶ç´„äº‹é …

### 9.1 æŠ€è¡“çš„åˆ¶ç´„

#### 9.1.1 ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èª
- **Python 3.11ä»¥ä¸Š**: æœ€æ–°ã®å‹ãƒ’ãƒ³ãƒˆæ©Ÿèƒ½ï¼ˆPEP 673ç­‰ï¼‰ã‚’ä½¿ç”¨
- **éåŒæœŸå‡¦ç†**: asyncio/awaitã‚’ä½¿ç”¨ï¼ˆåŒæœŸç‰ˆã¯æä¾›ã—ãªã„ï¼‰

#### 9.1.2 ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
```python
# requirements.txtï¼ˆæœ€å°é™ã®ä¾å­˜é–¢ä¿‚ï¼‰
# ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¯„å›²ã¯ä¸Šé™ã‚’è¨­å®šã—ã€ç ´å£Šçš„å¤‰æ›´ã‚’é˜²æ­¢
fastapi>=0.100.0,<0.110.0       # 0.110.0ã¯Pydantic v3å¿…é ˆã®ç ´å£Šçš„å¤‰æ›´ã‚ã‚Š
pydantic[email]>=2.0.0,<3.0.0   # v2ç³»ã®ã¿ã‚µãƒãƒ¼ãƒˆã€v3ã¯å¤§å¹…ãªAPIå¤‰æ›´
python-jose[cryptography]>=3.3.0,<4.0.0  # v4ã§APIå¤‰æ›´ã®å¯èƒ½æ€§
passlib[bcrypt]>=1.7.4,<2.0.0   # bcryptäº’æ›æ€§ç¶­æŒ
azure-cosmos>=4.5.0,<5.0.0      # v5ã§éåŒæœŸAPIãŒå¤§å¹…å¤‰æ›´
python-multipart>=0.0.6,<1.0.0  # ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—å¯¾ç­–

# æ—¢çŸ¥ã®äº’æ›æ€§å•é¡Œ
# - FastAPI 0.110.0+ ã¨ Pydantic v2 ã®çµ„ã¿åˆã‚ã›ã§å‹ãƒ’ãƒ³ãƒˆè§£æ±ºã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ
#   å¯¾ç­–: FastAPI < 0.110.0 ã«å›ºå®š
# - azure-cosmos 5.0.0 ã§éåŒæœŸAPIï¼ˆasync/awaitï¼‰ã®å¼•æ•°é †åºãŒå¤‰æ›´
#   å¯¾ç­–: 4.xç³»ã«å›ºå®šã—ã€Phase2ã§ç§»è¡Œè¨ˆç”»ã‚’ç­–å®š
# - Pydantic v3 ã¯å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®šç¾©ãŒField()å¿…é ˆã¨ãªã‚‹ç ´å£Šçš„å¤‰æ›´
#   å¯¾ç­–: v2ç³»ã§å®‰å®šé‹ç”¨å¾Œã€Phase2ã§æ®µéšçš„ç§»è¡Œ

# æ¨å¥¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆé–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆã§ä½¿ç”¨ï¼‰
# fastapi==0.109.0
# pydantic[email]==2.5.3
# python-jose[cryptography]==3.3.0
# passlib[bcrypt]==1.7.4
# azure-cosmos==4.5.1
# python-multipart==0.0.6
```

#### 9.1.3 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- **Cosmos DBå°‚ç”¨**: ä»–ã®NoSQL/RDBMSã¯ã‚µãƒãƒ¼ãƒˆå¯¾è±¡å¤–
- **éåŒæœŸAPIã®ã¿**: åŒæœŸAPIã¯æä¾›ã—ãªã„

### 9.2 ãƒ“ã‚¸ãƒã‚¹çš„åˆ¶ç´„

#### 9.2.1 Phase1ã‚¹ã‚³ãƒ¼ãƒ—
- **æœ€å°æ©Ÿèƒ½ã‚»ãƒƒãƒˆ**: ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã€ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ã€åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ç­‰ã¯Phase2
- **ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**: æœ¬ç•ªç’°å¢ƒã§ã®å¤§è¦æ¨¡é‹ç”¨ã¯æƒ³å®šå¤–

#### 9.2.2 å¾Œæ–¹äº’æ›æ€§
- **Phase1æœŸé–“ä¸­ã¯ç ´å£Šçš„å¤‰æ›´ãªã—**: ä¸€åº¦ãƒªãƒªãƒ¼ã‚¹ã—ãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯ç¶­æŒ
- **Phase2ä»¥é™ã¯ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°**: ç ´å£Šçš„å¤‰æ›´æ™‚ã¯ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—

---

## 10. é–¢ä¿‚è€…ã¨ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³

### 10.1 ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼

| å½¹å‰² | é–¢å¿ƒäº‹ | ã“ã®ã‚¿ã‚¹ã‚¯ã§ã®æœŸå¾… |
|-----|-------|------------------|
| **ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚ªãƒ¼ãƒŠãƒ¼** | é–‹ç™ºé€Ÿåº¦ã€å“è³ª | å¾Œç¶šã‚¿ã‚¹ã‚¯ã‚’åŠ é€Ÿã—ã€å…¨ä½“ã®å“è³ªã‚’å‘ä¸Š |
| **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–‹ç™ºãƒãƒ¼ãƒ ** | ä½¿ã„ã‚„ã™ã•ã€æ©Ÿèƒ½ã®å……å®Ÿ | èªè¨¼ã€DBæ¥ç¶šã‚’è‡ªåˆ†ã§å®Ÿè£…ã›ãšã«æ¸ˆã‚€ |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒ¼ãƒ ** | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ä¸€è²«æ€§ | èªè¨¼ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç®¡ç†ãŒå…¨ã‚µãƒ¼ãƒ“ã‚¹ã§çµ±ä¸€ |
| **é‹ç”¨ãƒãƒ¼ãƒ ** | ãƒ­ã‚®ãƒ³ã‚°ã€ç›£è¦– | æ§‹é€ åŒ–ãƒ­ã‚°ã«ã‚ˆã‚Šå•é¡Œã®æ—©æœŸç™ºè¦‹ãŒå¯èƒ½ |
| **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒˆ** | ã‚³ãƒ¼ãƒ‰ã®ä¸€è²«æ€§ã€ä¿å®ˆæ€§ | å…¨ã‚µãƒ¼ãƒ“ã‚¹ã§çµ±ä¸€ã•ã‚ŒãŸã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ |

### 10.2 å ±å‘Šã™ã¹ãæƒ…å ±

#### 10.2.1 ã‚¿ã‚¹ã‚¯å®Œäº†æ™‚
- âœ… ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ã‚¸ãƒ§ãƒ³
- âœ… ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆ
- âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆçµæœ
- âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³çµæœ
- âœ… ä½¿ç”¨æ–¹æ³•ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆREADME.mdï¼‰

#### 10.2.2 é–‹ç™ºæœŸé–“ä¸­ï¼ˆé€±æ¬¡ï¼‰
- ğŸ“Š å®Ÿè£…é€²æ—ï¼ˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ¥ï¼‰
- ğŸš¨ ç™ºè¦‹ã•ã‚ŒãŸæŠ€è¡“çš„èª²é¡Œ
- ğŸ“ˆ ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®æ¨ç§»

---

## 11. æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### 11.1 ã“ã®ã‚¿ã‚¹ã‚¯å®Œäº†å¾Œã®ãƒ“ã‚¸ãƒã‚¹çš„ãªæ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **å¾Œç¶šã‚µãƒ¼ãƒ“ã‚¹é–‹ç™ºã®åŠ é€Ÿ**: å„ã‚µãƒ¼ãƒ“ã‚¹ãƒãƒ¼ãƒ ãŒå…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦é–‹ç™ºé–‹å§‹
2. **ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®åŠ¹ç‡åŒ–**: å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«æ²¿ã£ã¦ã„ã‚‹ã‹ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼
3. **ç¶™ç¶šçš„ãªæ”¹å–„**: å„ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’åé›†ã—ã€Phase2ã§æ©Ÿèƒ½æ‹¡å¼µ

### 11.2 ä¾å­˜ã™ã‚‹å¾Œç¶šã‚¿ã‚¹ã‚¯

ã“ã®ã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã—ãªã„ã¨ç€æ‰‹ã§ããªã„ä¸»è¦ã‚¿ã‚¹ã‚¯ï¼š

- **03. èªè¨¼èªå¯ã‚µãƒ¼ãƒ“ã‚¹ - ã‚³ã‚¢API**: `common.auth`ã‚’ä½¿ç”¨ã—ãŸJWTç™ºè¡Œãƒ»æ¤œè¨¼
- **05. ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹ - ã‚³ã‚¢API**: `common.database.BaseRepository`ã‚’ä½¿ç”¨ã—ãŸCRUDå®Ÿè£…
- **07. ã‚µãƒ¼ãƒ“ã‚¹è¨­å®šã‚µãƒ¼ãƒ“ã‚¹ - ã‚³ã‚¢API**: åŒä¸Š
- **09. ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒ“ã‚¹åŸºç›¤**: å…¨ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒ“ã‚¹ãŒå…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨
- **14. Frontend - BFFåŸºç›¤**: BFFå±¤ã§ã‚‚å…±é€šã®ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã‚’ä½¿ç”¨

### 11.3 Phase2ã§ã®æ‹¡å¼µäºˆå®šæ©Ÿèƒ½

- [ ] **ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³**: ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®è‡ªå‹•æ›´æ–°
- [ ] **JWTæ¤œè¨¼ã®ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°**: Redisä½¿ç”¨ã«ã‚ˆã‚‹æ¤œè¨¼é«˜é€ŸåŒ–
- [ ] **åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°**: OpenTelemetryçµ±åˆ
- [ ] **ãƒ¬ãƒ¼ãƒˆåˆ¶é™**: Redisãƒ™ãƒ¼ã‚¹ã®ãƒ¬ãƒ¼ãƒˆåˆ¶é™æ©Ÿèƒ½
- [ ] **ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•**: Azure Service Busã¨ã®çµ±åˆ
- [ ] **ç›£æŸ»ãƒ­ã‚°ãƒ˜ãƒ«ãƒ‘ãƒ¼**: ç›£æŸ»ãƒ­ã‚°ã®è‡ªå‹•è¨˜éŒ²

---

## 12. å‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### 12.1 å†…éƒ¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [ã‚µãƒ¼ãƒ“ã‚¹æ¦‚è¦](../../init.md)
- [ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦](../../arch/overview.md)
- [ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ - å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒª](../../arch/components/README.md#8-å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒª)
- [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ - èªè¨¼](../../arch/security/README.md#2-èªè¨¼-authentication)
- [ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«è¨­è¨ˆ](../../arch/data/README.md)
- [é–‹ç™ºã‚¿ã‚¹ã‚¯ä¸€è¦§](../é–‹ç™ºã‚¿ã‚¹ã‚¯.md)

### 12.2 å¤–éƒ¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [FastAPI Documentation](https://fastapi.tiangolo.com/)
- [Pydantic Documentation](https://docs.pydantic.dev/)
- [Azure Cosmos DB Python SDK](https://docs.microsoft.com/azure/cosmos-db/sql/sql-api-sdk-python)
- [python-jose Documentation](https://python-jose.readthedocs.io/)
- [passlib Documentation](https://passlib.readthedocs.io/)

### 12.3 é–¢é€£æ¨™æº–
- **ISO29148**: Systems and software engineering â€” Life cycle processes â€” Requirements engineering
- **IEEE1016**: Standard for Information Technologyâ€”Systems Designâ€”Software Design Descriptions
- **OWASP**: Secure Coding Practices

---

## å¤‰æ›´å±¥æ­´

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜ | å¤‰æ›´å†…å®¹ | æ‰¿èªè€… |
|----------|------|---------|--------|
| 1.0.0 | 2026-02-01 | åˆç‰ˆä½œæˆ | - |
| 1.1.0 | 2026-02-01 | ãƒ¬ãƒ“ãƒ¥ãƒ¼æŒ‡æ‘˜å¯¾å¿œï¼ˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è©³ç´°ã€ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸äº’æ›æ€§ã€ãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢å¼·åŒ–ï¼‰ | - |

