# サービスの概要

複数サービスを提供する会社の管理アプリケーションを構築します。
管理アプリケーションは下記のマイクロサービスから構築されます。
アプリケーションはPoCとして構成されるため、軽量でかつエンタープライズレディな指標を用いた設計や実装は不要です。

- サービス1:Frontend
- サービス2:テナント管理サービス
- サービス3:認証認可サービス
- サービス4:利用サービス設定サービス

# 各サービスの役割

## Frontend

各サービスの機能を使用するための画面を提供します。  
Next.jsで提供する単一のWebAPIのエンドポイントを介して各サービスのエンドポイントにアクセスするBFF的な挙動となります。
本アプリケーションへのログインは特権テナントに所属するユーザーしか行えません

## テナント管理サービス

テナントとテナントに所属するユーザーの管理を行えます。　　

### 詳細な機能について

- テナント一覧
  - 管理するテナントの一覧を確認できる
  - テナント名、テナントユーザー数、作成日、利用サービスが確認できる
  - この画面から権限を持つユーザーは新規作成と既存テナントの編集を行う画面に移動を行うことが可能
- テナント詳細
  - テナント名、テナントに所属するユーザー、利用サービスの編集、テナントに所属するユーザードメインの編集を行うことが可能
  - テナントの編集は特権テナントに所属する特定ロールをもつユーザーしか変更できない
  - ユーザーは認証認可サービスで管理されているユーザーを追加する形式となる

### 特権テナントについて

- このテナントは削除・編集できない
- このテナントのユーザー追加と削除は「全体管理者」ロールしか行えない

### このサービスのロールについて

- 全体管理者:特権テナントに対する操作が可能
- 管理者:通常のテナントの追加・削除・編集が可能
- 閲覧者:テナント情報の参照が可能

## 認証認可サービス

ユーザーとユーザーが持つ権限の管理を行えます

### 詳細な機能について

- ユーザー一覧
  - ユーザーの一覧を参照可能。ユーザー名、作成日、所属テナントを確認できる
  - この画面から権限を持つユーザーは新規登録と編集を行う画面に移動を行うことが可能
- ユーザー編集
  - ユーザー名、ユーザーID、初期パスワード、所持ロールを編集参照することが可能
- 認証認可エンドポイント
  - ID/PASSWORDをベースに、認証が問題ない場合、認可情報も含めたJWTを返却する
  - JWTが正しいか検証する

### このサービスのロールについて

- 全体管理者:ユーザーの登録・削除を行うことが可能
- 閲覧者:ユーザーの参照を行うことが可能


### ロールについて

- ロールの情報は各サービスの専用WebAPIから収集します
  - WebAPIの設定情報は各サービスのDBテーブルに格納されます
- テナントがAサービスとBサービスを使用できる状態になっている場合、AサービスとBサービスのロールのみが設定できます
  - 使用できないサービス（Cサービス）がある場合はその設定項目は表示されません

## 利用サービス設定サービス

各テナントで使用できるサービスを設定できます。

### 詳細な機能について

- テナントに対してテナントが利用できるサービスを割り当てることができます
- テナントを割り当てることができるのは管理者のみとなります

### このサービスのロールについて

- 全体管理者:テナントにサービスを割り当てることができます
- 閲覧者:情報の参照が可能

# モックサービスについて

上記に記載している以外のサービスとサービスに必要なロールを用意します。
必要なロールは判断して追加してください。

- ファイル管理サービス
- メッセージングサービス
- API利用サービス
- バックアップサービス

Mockサービスは個別のサービスとして構築する必要はなくBFFを介してアクセスしたさいにMockデータを返却する構成で結構です。

# 技術情報

## アプリケーションで使用する技術

- フロントエンド: React(Next.jsでBFFを構成)
- バックエンド: Python(Fast APIを使用)
- DB: Cosmos DB
- IaC: Bycep

## ソース構成

/
/infra:IaCコードを格納
/docs:ドキュメントを格納
/src:実行ソースコードを格納
/src/front
/src/auth-service
/src/tenant-management-service
/src/service-setting-service

# 注意事項

- このアプリケーションはサンプルとして構築されるため過度な仕様の構築は不要です。
  - Redisなどを利用したキャッシュ戦略は不要です。必要最小限の構成の構築でOKです
- Azureなども最小限のコストで構築できるように考慮する必要があります。