# 未確定事項・検討事項 (Open Questions)

**最終更新**: 2026-01-24

このドキュメントでは、仕様策定中に判断が必要となった事項、明確化が望ましい事項をまとめています。

## 凡例

| 優先度 | 説明 |
|-------|------|
| 🔴 High | 実装前に決定が必要 |
| 🟡 Medium | 初期実装後でも変更可能 |
| 🟢 Low | 将来的に検討 |

---

## 認証・認可関連

### OQ-001: JWTの保存場所 🔴

**質問**: JWTトークンはどこに保存すべきか？

**選択肢**:
| オプション | メリット | デメリット |
|-----------|---------|-----------|
| A. HttpOnly Cookie | XSS対策、自動送信 | CSRF対策が必要 |
| B. LocalStorage | 実装が簡単 | XSS脆弱性 |
| C. メモリ（BFF側） | 最もセキュア | リロードで消失 |

**現在の想定**: オプションA（HttpOnly Cookie）

**決定待ち**: セキュリティチームのレビュー

---

### OQ-002: リフレッシュトークンの扱い 🔴

**質問**: リフレッシュトークンのローテーション戦略は？

**選択肢**:
- A. 毎回新しいリフレッシュトークンを発行（ローテーション）
- B. リフレッシュトークンは固定（有効期限まで再利用）

**現在の想定**: オプションA（セキュリティ重視）

**決定待ち**: パフォーマンスへの影響評価

---

### OQ-003: アカウントロックの解除方法 🟡

**質問**: ロックされたアカウントの解除はどうするか？

**選択肢**:
- A. 時間経過のみ（30分）
- B. 管理者による手動解除も可能
- C. メールによる本人確認で解除

**現在の想定**: オプションB

**決定待ち**: 運用フローの確定

---

## テナント管理関連

### OQ-004: ユーザーの複数テナント所属 🔴

**質問**: 1ユーザーは複数のテナントに所属できるか？

**選択肢**:
- A. 可能（ログイン時にテナント選択）
- B. 不可（1ユーザー1テナント）

**現在の想定**: オプションA（仕様書では複数所属を想定）

**影響範囲**:
- JWTのペイロード構造
- テナントコンテキストの切り替えUI
- 権限判定ロジック

**決定待ち**: ビジネス要件の確認

---

### OQ-005: テナント削除時のデータ処理 🟡

**質問**: テナント削除時、所属ユーザーやデータはどうなるか？

**選択肢**:
- A. 論理削除（データは保持、アクセス不可）
- B. 物理削除（完全にデータ消去）
- C. 削除不可（所属ユーザーがいる場合）

**現在の想定**: オプションC → A の順で実装

**決定待ち**: データ保持ポリシーの確定

---

### OQ-006: ユーザードメイン制限の強制力 🟡

**質問**: 許可ドメイン外のユーザー追加はどう扱うか？

**選択肢**:
- A. エラーとして拒否
- B. 警告を表示するが追加は可能
- C. 管理者のみ許可ドメイン外も追加可能

**現在の想定**: オプションB（仕様書では「警告を表示」）

**決定待ち**: セキュリティポリシーの確認

---

## サービス設定関連

### OQ-007: サービス割当解除時のロール処理 🔴

**質問**: テナントからサービス割当を解除した場合、そのサービスのロールを持つユーザーはどうなるか？

**選択肢**:
- A. ロールを自動削除
- B. ロールは保持（再割当時に有効化）
- C. 解除前に警告、確認後にロール削除

**現在の想定**: オプションC

**影響範囲**:
- ユーザーロール管理のUI/API
- JWT生成時のロール収集ロジック

**決定待ち**: UX設計の確定

---

### OQ-008: ロール同期のタイミング 🟡

**質問**: 各サービスからのロール情報はいつ同期するか？

**選択肢**:
- A. リアルタイム（毎回APIコール）
- B. 定期バッチ（1時間毎など）
- C. キャッシュ + 手動リフレッシュ
- D. Webhook（変更時に通知）

**現在の想定**: オプションC

**決定待ち**: パフォーマンス要件の確定

---

## UI/UX関連

### OQ-009: エラーメッセージの多言語対応 🟢

**質問**: エラーメッセージは多言語対応するか？

**選択肢**:
- A. 日本語のみ
- B. 日本語 + 英語
- C. i18n対応（将来的に複数言語）

**現在の想定**: オプションA（初期リリース）

**決定待ち**: グローバル展開計画の確認

---

### OQ-010: 操作ログの表示範囲 🟢

**質問**: 管理者は他ユーザーの操作ログを参照できるか？

**選択肢**:
- A. 全ユーザーのログを参照可能
- B. 同一テナント内のユーザーのみ
- C. ログ参照機能なし（バックエンドのみ）

**現在の想定**: 未定

**決定待ち**: 監査要件の確定

---

## インフラ・運用関連

### OQ-011: 環境構成 🔴

**質問**: どの環境を用意するか？

**選択肢**:
- A. 開発 / ステージング / 本番
- B. 開発 / 本番
- C. 開発 / QA / ステージング / 本番

**現在の想定**: オプションA

**決定待ち**: 予算・運用体制の確定

---

### OQ-012: Cosmos DBのスループット設定 🟡

**質問**: プロビジョニングスループット or サーバーレス？

**選択肢**:
- A. プロビジョニング（固定RU/s）
- B. サーバーレス（従量課金）
- C. オートスケール

**現在の想定**: オプションC（コスト最適化）

**決定待ち**: 想定トラフィック量の確定

---

### OQ-013: サービス間通信の認証 🔴

**質問**: バックエンドサービス間の通信はどう認証するか？

**選択肢**:
- A. サービス間JWT
- B. Azure Managed Identity
- C. APIキー
- D. VNet内通信のため認証なし

**現在の想定**: オプションB

**決定待ち**: Azureアーキテクチャ設計の確定

---

## データ関連

### OQ-014: 初期データ投入 🟡

**質問**: 特権テナントと初期管理者ユーザーはどう作成するか？

**選択肢**:
- A. デプロイスクリプトで自動作成
- B. 初回起動時にセットアップウィザード
- C. シードデータとしてDBに直接投入

**現在の想定**: オプションA

**決定待ち**: デプロイ手順の確定

---

### OQ-015: 監査ログの保持期間 🟡

**質問**: ログイン履歴等の監査ログはどれくらい保持するか？

**選択肢**:
- A. 90日（現在の想定）
- B. 1年
- C. 無期限（アーカイブ）

**現在の想定**: オプションA

**決定待ち**: コンプライアンス要件の確認

---

## 決定済み事項

以下の事項は検討の結果、決定済みです。

| ID | 項目 | 決定内容 | 決定日 |
|-----|------|---------|-------|
| - | - | - | - |

---

## 次のアクション

1. 🔴 優先度Highの項目について、ステークホルダーとの確認MTGを設定
2. セキュリティチームによるOQ-001, OQ-002のレビュー依頼
3. ビジネス側へOQ-004（複数テナント所属）の要件確認

---

*このドキュメントは継続的に更新されます。新たな疑問点が発生した場合は追記してください。*
