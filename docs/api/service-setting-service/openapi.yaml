openapi: 3.0.3
info:
  title: Service Settings Service API
  description: |
    Service configuration and feature flag management REST API for the SaaS Management Application.
    
    This service handles:
    - Service configuration management
    - Feature flag control
    - Application settings per tenant
    - Environment-specific configurations
    - Runtime configuration updates
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:3003/api
    description: Development server
  - url: https://settings-staging.example.com/api
    description: Staging server
  - url: https://settings.example.com/api
    description: Production server

tags:
  - name: Settings
    description: Service settings operations
  - name: Feature Flags
    description: Feature flag management
  - name: Configurations
    description: Configuration management

paths:
  /settings:
    get:
      tags:
        - Settings
      summary: List all settings
      description: Get all settings with optional filtering
      operationId: listSettings
      security:
        - bearerAuth: []
      parameters:
        - name: category
          in: query
          description: Filter by setting category
          schema:
            type: string
            example: feature_flags
        - name: tenantId
          in: query
          description: Filter by tenant ID
          schema:
            type: string
            example: tenant-123
        - name: scope
          in: query
          description: Filter by scope
          schema:
            type: string
            enum: [global, tenant, user]
      responses:
        '200':
          description: Settings retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SettingsListResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'

    post:
      tags:
        - Settings
      summary: Create setting
      description: Create a new service setting
      operationId: createSetting
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSettingRequest'
            examples:
              featureFlag:
                summary: Create feature flag
                value:
                  key: experimental_ui
                  value: true
                  category: feature_flags
                  scope: global
                  description: Enable experimental UI features
      responses:
        '201':
          description: Setting created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SettingResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '409':
          description: Conflict - setting already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /settings/{settingId}:
    parameters:
      - $ref: '#/components/parameters/SettingIdParam'

    get:
      tags:
        - Settings
      summary: Get setting by ID
      description: Retrieve a specific setting
      operationId: getSettingById
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Setting retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SettingResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

    put:
      tags:
        - Settings
      summary: Update setting
      description: Update an existing setting
      operationId: updateSetting
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSettingRequest'
      responses:
        '200':
          description: Setting updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SettingResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

    delete:
      tags:
        - Settings
      summary: Delete setting
      description: Delete a setting
      operationId: deleteSetting
      security:
        - bearerAuth: []
      responses:
        '204':
          description: Setting deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /settings/key/{key}:
    parameters:
      - name: key
        in: path
        required: true
        description: Setting key
        schema:
          type: string
          example: experimental_ui

    get:
      tags:
        - Settings
      summary: Get setting by key
      description: Retrieve a setting by its key
      operationId: getSettingByKey
      security:
        - bearerAuth: []
      parameters:
        - name: tenantId
          in: query
          description: Tenant ID for tenant-scoped settings
          schema:
            type: string
      responses:
        '200':
          description: Setting retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SettingResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /feature-flags:
    get:
      tags:
        - Feature Flags
      summary: List feature flags
      description: Get all feature flags
      operationId: listFeatureFlags
      security:
        - bearerAuth: []
      parameters:
        - name: tenantId
          in: query
          description: Filter by tenant ID
          schema:
            type: string
        - name: enabled
          in: query
          description: Filter by enabled status
          schema:
            type: boolean
      responses:
        '200':
          description: Feature flags retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/FeatureFlag'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'

    post:
      tags:
        - Feature Flags
      summary: Create feature flag
      description: Create a new feature flag
      operationId: createFeatureFlag
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateFeatureFlagRequest'
      responses:
        '201':
          description: Feature flag created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/FeatureFlag'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'

  /feature-flags/{flagKey}:
    parameters:
      - name: flagKey
        in: path
        required: true
        description: Feature flag key
        schema:
          type: string
          example: new_dashboard

    get:
      tags:
        - Feature Flags
      summary: Get feature flag
      description: Get a specific feature flag
      operationId: getFeatureFlag
      security:
        - bearerAuth: []
      parameters:
        - name: tenantId
          in: query
          description: Tenant ID for tenant-specific override
          schema:
            type: string
      responses:
        '200':
          description: Feature flag retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/FeatureFlag'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

    put:
      tags:
        - Feature Flags
      summary: Update feature flag
      description: Update a feature flag
      operationId: updateFeatureFlag
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateFeatureFlagRequest'
      responses:
        '200':
          description: Feature flag updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/FeatureFlag'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

    delete:
      tags:
        - Feature Flags
      summary: Delete feature flag
      description: Delete a feature flag
      operationId: deleteFeatureFlag
      security:
        - bearerAuth: []
      responses:
        '204':
          description: Feature flag deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /feature-flags/{flagKey}/toggle:
    parameters:
      - name: flagKey
        in: path
        required: true
        description: Feature flag key
        schema:
          type: string

    post:
      tags:
        - Feature Flags
      summary: Toggle feature flag
      description: Toggle a feature flag on or off
      operationId: toggleFeatureFlag
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - enabled
              properties:
                enabled:
                  type: boolean
                  description: New enabled state
                  example: true
                tenantId:
                  type: string
                  description: Tenant ID for tenant-specific override
                  example: tenant-123
      responses:
        '200':
          description: Feature flag toggled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/FeatureFlag'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /configurations:
    get:
      tags:
        - Configurations
      summary: List configurations
      description: Get all service configurations
      operationId: listConfigurations
      security:
        - bearerAuth: []
      parameters:
        - name: service
          in: query
          description: Filter by service name
          schema:
            type: string
            example: auth-service
        - name: environment
          in: query
          description: Filter by environment
          schema:
            type: string
            enum: [development, staging, production]
      responses:
        '200':
          description: Configurations retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Configuration'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'

    post:
      tags:
        - Configurations
      summary: Create configuration
      description: Create a new service configuration
      operationId: createConfiguration
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateConfigurationRequest'
      responses:
        '201':
          description: Configuration created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Configuration'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'

  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: Basic health check endpoint
      operationId: healthCheck
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthCheckResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from authentication service

  parameters:
    SettingIdParam:
      name: settingId
      in: path
      required: true
      description: Setting identifier
      schema:
        type: string
        example: setting-123

  responses:
    BadRequestError:
      description: Bad request - validation error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    UnauthorizedError:
      description: Unauthorized - invalid or missing token
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    ForbiddenError:
      description: Forbidden - insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    NotFoundError:
      description: Not found - resource does not exist
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

  schemas:
    Setting:
      type: object
      properties:
        id:
          type: string
          description: Unique setting identifier
          example: setting-123
        key:
          type: string
          description: Setting key
          example: max_users_per_tenant
        value:
          description: Setting value (can be any JSON type)
          oneOf:
            - type: string
            - type: number
            - type: boolean
            - type: object
            - type: array
          example: 100
        category:
          type: string
          description: Setting category
          example: limits
        scope:
          type: string
          enum: [global, tenant, user]
          description: Setting scope
          example: tenant
        tenantId:
          type: string
          description: Tenant ID (for tenant-scoped settings)
          example: tenant-123
        description:
          type: string
          description: Setting description
          example: Maximum number of users allowed per tenant
        isEncrypted:
          type: boolean
          description: Whether the value is encrypted
          default: false
        createdAt:
          type: string
          format: date-time
          example: '2026-01-01T00:00:00Z'
        updatedAt:
          type: string
          format: date-time
          example: '2026-01-11T15:00:00Z'

    CreateSettingRequest:
      type: object
      required:
        - key
        - value
        - category
        - scope
      properties:
        key:
          type: string
          minLength: 1
          example: max_api_calls_per_minute
        value:
          description: Setting value
          example: 1000
        category:
          type: string
          example: rate_limits
        scope:
          type: string
          enum: [global, tenant, user]
          example: global
        tenantId:
          type: string
          description: Required for tenant-scoped settings
          example: tenant-123
        description:
          type: string
          example: Maximum API calls per minute
        isEncrypted:
          type: boolean
          default: false

    UpdateSettingRequest:
      type: object
      properties:
        value:
          description: New setting value
          example: 2000
        description:
          type: string
          example: Updated description

    SettingResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          $ref: '#/components/schemas/Setting'

    SettingsListResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: array
          items:
            $ref: '#/components/schemas/Setting'

    FeatureFlag:
      type: object
      properties:
        key:
          type: string
          description: Feature flag key
          example: new_dashboard
        enabled:
          type: boolean
          description: Whether the feature is enabled
          example: true
        name:
          type: string
          description: Human-readable name
          example: New Dashboard
        description:
          type: string
          description: Feature description
          example: Enable the new dashboard UI
        rolloutPercentage:
          type: number
          minimum: 0
          maximum: 100
          description: Percentage of users to enable this feature for
          example: 50
        tenantOverrides:
          type: object
          additionalProperties:
            type: boolean
          description: Tenant-specific overrides
          example:
            tenant-123: true
            tenant-456: false
        createdAt:
          type: string
          format: date-time
          example: '2026-01-01T00:00:00Z'
        updatedAt:
          type: string
          format: date-time
          example: '2026-01-11T15:00:00Z'

    CreateFeatureFlagRequest:
      type: object
      required:
        - key
        - name
      properties:
        key:
          type: string
          minLength: 1
          example: experimental_search
        name:
          type: string
          example: Experimental Search
        description:
          type: string
          example: Enable experimental search features
        enabled:
          type: boolean
          default: false
        rolloutPercentage:
          type: number
          minimum: 0
          maximum: 100
          default: 0

    UpdateFeatureFlagRequest:
      type: object
      properties:
        name:
          type: string
          example: Updated Feature Name
        description:
          type: string
          example: Updated description
        enabled:
          type: boolean
          example: true
        rolloutPercentage:
          type: number
          minimum: 0
          maximum: 100
          example: 75

    Configuration:
      type: object
      properties:
        id:
          type: string
          example: config-123
        service:
          type: string
          description: Service name
          example: auth-service
        environment:
          type: string
          enum: [development, staging, production]
          example: production
        config:
          type: object
          additionalProperties: true
          description: Configuration values
          example:
            jwtExpiresIn: 3600
            maxLoginAttempts: 5
        version:
          type: string
          example: 1.0.0
        createdAt:
          type: string
          format: date-time
          example: '2026-01-01T00:00:00Z'
        updatedAt:
          type: string
          format: date-time
          example: '2026-01-11T15:00:00Z'

    CreateConfigurationRequest:
      type: object
      required:
        - service
        - environment
        - config
      properties:
        service:
          type: string
          example: user-service
        environment:
          type: string
          enum: [development, staging, production]
          example: production
        config:
          type: object
          additionalProperties: true
          example:
            cacheTimeout: 300
            maxPageSize: 100
        version:
          type: string
          example: 1.0.0

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          properties:
            code:
              type: string
              example: RESOURCE_NOT_FOUND
            message:
              type: string
              example: Setting not found
            details:
              type: object
              additionalProperties: true
        metadata:
          type: object
          properties:
            timestamp:
              type: string
              format: date-time
              example: '2026-01-11T15:00:00Z'
            requestId:
              type: string
              example: req-abc123def456

    HealthCheckResponse:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
          example: healthy
        version:
          type: string
          example: 1.0.0
        uptime:
          type: number
          example: 86400
        timestamp:
          type: string
          format: date-time
          example: '2026-01-11T15:00:00Z'
        dependencies:
          type: object
          properties:
            database:
              type: string
              enum: [healthy, unhealthy]
              example: healthy
            cache:
              type: string
              enum: [healthy, unhealthy]
              example: healthy

security:
  - bearerAuth: []
