# GitHub Copilotを使用したコードとドキュメントを利用した開発初期作業

GitHub Copilotを使用してコードとドキュメントから下記の作業を実施します。

0. 事前準備
1. 現時点のコードや機能の理解
2. 開発計画の作成
3. 開発チケットの作成
4. 不具合や質問に対する調査
5. カスタムエージェントを構築したより詳細な開発計画の作成

## 0. 事前準備

このリポジトリをCloneするかForkします。
Dockerが使用できる場合はDevContainerでコードを開き、Codespacesが使用できる場合はそこからコードを参照してみましょう。

`gh auth login` を使用してリポジトリを参照できるように設定します。

## 1.現時点のコードや機能の理解

現在参照しているリポジトリはコードと関連するドキュメントが格納されています。
リポジトリは複数のマイクロサービスで管理されたリポジトリを統合するリポジトリの構成となっています。
まずはAskモードで質問を行いこのリポジトリでどのようなアプリケーションが提供されるのか確認を行いましょう。

```markdown
このリポジトリで提供されるアプリケーションについて説明を行ってください。
下記の項目についてまとめる必要があります。

1. このアプリケーションで実現できるビジネス的価値
2. アプリケーションの構造
3. 展開先
4. デバッグ実行の仕方
```

## 2. 開発計画の作成

現在のアプリへの機能追加をテーマに開発計画を作成します。
Planモードを使用し機能追加の検討を行います。
現在はサービス管理画面には有効/無効しかありませんが、サービス特有の機能を有効化する機能を追加します。

```markdown
現在の機能に対して「サービス特有機能の有効/無効化機能」を追加します。
サービスが持つ機能はサービスマスタに紐づく形で管理され、テナントごとに有効/無効を切り替えることが可能です。
下記の仕様で動作します。

- 機能の有効化はサービスが利用可能なものしか設定できません
- 機能は単一のサービスに対して複数の設定が存在します
- 機能は有効/無効の設定を持ちます
- 現在はMockデータが構築されている為、同様にMockデータを構築する必要があります。

作成される文書はISO29148で要求される情報を含む必要があります。
```

プロンプトを実行すると懸念事項という形でQAが提示されます。QAのやりとりを重ねて懸念事項を減らしていきます。
開発計画が作成されたら仕様をドキュメントに格納します。
Agentモードに切り替えて下記プロンプトを実行します。

```markdown
構築されたプランをもとにドキュメントを構築してください。
作成されたドキュメントは `docs/PoCアプリ/Specs/{追加機能名}` に格納してください。
```

## 3. 開発チケットの作成

作成された文章をベースに開発チケットを作成し登録します。
GitHubのリポジトリを複製した場合と複製していない場合で使用したいプロンプトが分岐されます。

```markdown
`docs/PoCアプリ/Spec/{追加機能名}`に格納された機能情報をベースに開発計画を作成します。
下記の方針で開発計画を作成し、gh コマンドを使用して開発タスクを登録してください。

- 開発タスクは統括する親Issueとそれの紐づく細かい作業のSub-Issueの構成で作成されます
- 開発タスク同士の依存関係や同時実行可能なタスクが存在する場合はそれを明記します
- 開発タスクの順番が明確にわかるようにタイトルに順番が記載されます
- 開発はSubmoduleで構成されているので適切なリポジトリにIssueが登録されなくてはいけません
```

GitHubリポジトリが存在しない場合は下記のプロンプトを実行します。

```markdown
`docs/PoCアプリ/Spec/{追加機能名}`に格納された機能情報をベースに開発計画を作成します。
下記の方針で開発計画を作成し、`docs/PoCアプリ`に開発タスクを作成してください。

- 開発タスクは統括する親Issueとそれの紐づく細かい作業のSub-Issueの構成で作成されます
- 開発タスク同士の依存関係や同時実行可能なタスクが存在する場合はそれを明記します
- 開発タスクの順番が明確にわかるようにタイトルに順番が記載されます
```

## 4. 不具合や質問に対する調査

ユーザーからの問い合わせがあったことを想定し、コードやドキュメントをベースに問い合わせの解決を試みます。
Askモードで下記のようなプロンプトを実行しましょう

```markdown
下記の問い合わせに対する回答を作成してください。

> ユーザー作成画面のボタンがポインタに変更されません。

ソースコードやドキュメントを参照し、回答を作成してください。
```

## 5. カスタムエージェントを構築したより詳細な開発計画の0からの作成

自前のカスタムエージェントを作成して先ほどの開発計画の作成がどのように変わるか確認してみます。

### 5-1.カスタムエージェントを作成します

```markdown
開発計画を作成するためのカスタムエージェントを作成します。
カスタムエージェントはサブエージェントを有しており、作業をオーケストレーションする親エージェントと作業を実施するサブエージェントで構成されます。
オーケストレーションエージェントは実際の作業は実施せず、サブエージェントが作業を実施するという構成にする必要があります。
作業は下記の手順で実施されます。

---

1. 提示された仕様を実現するためのビジネス要件を満たすための仕様を構築します
   - コードやドキュメントの情報を参考に構築します
   - ユーザーに確認すべきことがある場合は質問を実行し、その結果をベースに1の作業を再度実施します
   - 構築した仕様は `docs/{アプリ名}/{追加機能名}/Specs` に文書として生成します
2. 作成されたビジネス要件を満たすためのシステム仕様を満たすための仕様を構築します
   - コードやドキュメントの情報を参考に構築します
   - 構築した仕様は `docs/{アプリ名}/{追加機能名}/Specs` に生成された文書をアップデートします
3. 生成した文書をレビューします
   - ISO29148で定義された文書として有効か作成された文書に対してレビューを実施します
   - レビューした結果は `docs/{アプリ名}/{追加機能名}/review` に格納されいます
   - レビューは絶対に行われこの工程を独自の判断や時間の都合で飛ばすことはできません
   - レビューの結果不合格となった場合1からやり直します
     - ただし無限に繰り返されることを防ぐため繰り返しは3回までとします

---

カスタムエージェントとサブエージェントは下記のサイトを参考に構築を行います。
https://code.visualstudio.com/docs/copilot/agents/subagents
```

### 5-2.作成したカスタムエージェントを使用し開発計画を作成する

Agentモードから作成したカスタムエージェントに変更を行い下記のプロンプトを実行してみます。

```markdown
現在の機能に対して「サービス特有機能の有効/無効化機能」を追加します。
サービスが持つ機能はサービスマスタに紐づく形で管理され、テナントごとに有効/無効を切り替えることが可能です。
下記の仕様で動作します。

- 機能の有効化はサービスが利用可能なものしか設定できません
- 機能は単一のサービスに対して複数の設定が存在します
- 機能は有効/無効の設定を持ちます
- 現在はMockデータが構築されている為、同様にMockデータを構築する必要があります。
```
