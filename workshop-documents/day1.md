# GitHub Copilotを使用したコードとドキュメントを利用した開発初期作業

GitHub Copilotを使用してコードとドキュメントから下記の作業を実施します。

0. 事前準備
1. 現時点のコードや機能の理解
2. 不具合や質問に対する調査
3. 開発に関わる文書の作成
4. 文書のレビュー

以降Advanced

1. カスタムエージェントを構築したより開発計画の作成のフロー化

## 0. 事前準備

- 本リポジトリのFork、またはCloneでローカルに落とす
- `git submodule update --init --recursive` を実行しSubmoduleの中身をアップデートする

## 1.現時点のコードや機能の理解

現在参照しているリポジトリはコードと関連するドキュメントが格納されています。
リポジトリは複数のマイクロサービスで管理されたリポジトリを統合するリポジトリの構成となっています。
まずはAskモードで質問を行いこのリポジトリでどのようなアプリケーションが提供されるのか確認を行いましょう。

```markdown
このリポジトリで提供されるアプリケーションについて説明を行ってください。
下記の項目についてまとめる必要があります。

1. このアプリケーションで実現できるビジネス的価値
2. アプリケーションの構造
3. 展開先
4. デバッグ実行の仕方
5. このアプリケーションを利用する際のユースケース
```

## 2. 不具合や質問に対する調査

ユーザーからの問い合わせがあったことを想定し、コードやドキュメントをベースに問い合わせの解決を試みます。
Askモードで下記のようなプロンプトを実行しましょう

```markdown
下記の問い合わせに対する回答を作成してください。

> ユーザー作成画面のボタンがポインタに変更されません。

ソースコードやドキュメントを参照し、回答を作成してください。
```

## 3. 開発に関わる文書の作成

現在のアプリへの機能追加をテーマに開発計画を作成します。
Planモードを使用し機能追加の検討を行います。
現在はサービス管理画面には有効/無効しかありませんが、サービス特有の機能を有効化する機能を追加します。

```markdown
現在の機能に対して「サービス特有機能の有効/無効化機能」を追加します。
サービスが持つ機能はサービスマスタに紐づく形で管理され、テナントごとに有効/無効を切り替えることが可能です。
下記の仕様で動作します。

- 機能の有効化はサービスが利用可能なものしか設定できません
- 機能は単一のサービスに対して複数の設定が存在します
- 機能は有効/無効の設定を持ちます
- デモ用の簡易アプリとして構築する想定なので要件で省ける箇所は省きましょう
- 現在はMockデータが構築されている為、同様にMockデータを構築する必要があります

懸念事項、検討事項があれば質問や確認をしてください。
```

プロンプトを実行すると懸念事項という形でQAが提示されます。QAのやりとりを重ねて懸念事項を減らしていきます。
開発計画が作成されたら仕様をドキュメントに格納します。
Agentモードに切り替えて下記プロンプトを実行します。

**Thinking Time(5min)**

```markdown
構築されたプランをもとに機能追加のためのドキュメントを構築してください。
作成されたドキュメントは `docs/PoCアプリ/Specs/{追加機能名}` に格納されます。

下記は作成される文書の作成方針です
- 内部で記載される情報として図示したほうが適切な場合はMermaid記法で記述されます
- デモ用の簡易アプリとして構築する想定なので要件で省ける箇所は省きましょう
- 文書が長くなることが想定されるため、セグメントごとに文書を作成してください
<!--以下好きに条件をいじくってください-->
- 作成される文書はISO29148で要求される情報を含む必要があります。
- システム要件、ビジネス要件の双方から仕様を判断し仕様が検討されます
- ビジネスインパクト、または該当機能が必須とされる理由などが記載されます
- 既存のソースコード、文書を参照し影響範囲と必要な検証内容を洗い出し個別の文書として作成してください
```

---

# Advanced

## 4. レビュー用のエージェントを作成して運用してみる

作成されたドキュメントのレビューをAIに実施させてみます。
プロンプトでレビューをさせてもいいですが、ドキュメントのレビューは何度も実施することになりそうなので
カスタムエージェントを作成してレビューしてもらいます。カスタムエージェントを0から作るのではなくCpilotに作ってもらいます。

``` markdown
ドキュメントのレビューを行う専門のカスタムエージェントを構築します。
ドキュメントレビューエージェントは下記のように動作します。
- エージェントはレビュー専門で動くためレビュー対象の文書の変更は行いません
- 責務を遂行するためのToolsを利用するように構成されます
- エージェントは下記のようにレビューを実施します
  <!--ここから先は好きに変更していいです-->
  - 批判的な立場でレビューを実施します
  - ISOで要求されていることが網羅されているか確認します
  - 日本語の表現として適切な状態になっているかを確認します
  - 既存機能に追加するカスタマイズを実施するような仕様となっている場合は影響範囲が明記されているかどうか確認します
  - ビジネス的な観点からの到達目標が記載されているかを確認します
  - 以上の観点から文書の合格/不合格を判定し `docs/PoCアプリ/Specs/{追加機能名}/review`にレビュー結果を格納します
    - レビューには問題点と改善すべきポイントが記載されます
---
カスタムエージェントの構成とPracticeは下記サイトを参考にしてください
- https://docs.github.com/en/copilot/concepts/agents/coding-agent/about-custom-agents
- https://github.blog/ai-and-ml/github-copilot/how-to-write-a-great-agents-md-lessons-from-over-2500-repositories/
- https://docs.github.com/en/copilot/reference/custom-agents-configuration#tools
```

エージェント作成後は作成されたエージェントを使用してレビューを実施します。

``` markdown
docs/PoCアプリ/Specs/{機能名} に格納されている文書をレビューして下さい。
```

## 5. プレゼン資料の作成

新しい機能についてプレゼンするための資料を作成します。
Marp(Markdownでスライドを作るツール)でCopilotを作るパターン
``` markdown
`docs/PoCアプリ/Specs/{追加機能名}` の機能を実装するためのプレゼンを実施します。
出資者となる日本語話者のステークホルダーがターゲットの打ち合わせであるため、コスト・効果について言及される資料が要求されます。
打合せの時間は15分です。
Marpの構成でプレゼンで使用する資料を作成し `temp/specs/slide/{追加機能名}` に格納してください。
```

PowerPointのAgentにお願いするためのプロンプトを作成してもらうパターン
``` markdown
`docs/PoCアプリ/Specs/{追加機能名}` の機能を実装するためのプレゼンを実施します。
出資者となる日本語話者のステークホルダーがターゲットの打ち合わせであるため、コスト・効果について言及される資料が要求されます。
打合せの時間は15分です。
Marpの構成でプレゼンで使用する資料を作成し `temp/specs/slide/{追加機能名}` に格納してください。
```

## 6. カスタムエージェントを構築したより詳細な開発計画の0からの作成

自前のサブエージェント込みのカスタムエージェントを作成して先ほどの開発計画の作成までの工程を一気通貫、レビュー込みで実施します。

### 6-1.カスタムエージェントを作成します

```markdown
開発仕様を作成するためのカスタムエージェントを作成します。
カスタムエージェントはサブエージェントを有しており、作業をオーケストレーションする親エージェントと作業を実施するサブエージェントで構成されます。
オーケストレーションエージェントは実際の作業は実施せず、サブエージェントが作業を実施するという構成にする必要があります。
作業は下記の手順で実施されます。各エージェントの実行時にそれぞれの工程で作成した文書のパスを参考情報として引き渡す必要があります。

---

1. 提示された仕様を実現するためのビジネス要件を満たすための仕様を構築します
   - コードやドキュメントの情報を参考に構築します
   - ユーザーに確認すべきことがある場合は質問を実行し、その結果をベースに1の作業を再度実施します
   - 構築した仕様は `docs/{アプリ名}/{追加機能名}/Specs` に文書として生成します
2. 作成されたビジネス要件を満たすためのシステム仕様を満たすための仕様を構築します
   - コードやドキュメントの情報を参考に構築します
   - 構築した仕様は `docs/{アプリ名}/{追加機能名}/Specs` に生成された文書をアップデートします
3. 生成した文書をレビューします
   - ISO29148で定義された文書として有効か作成された文書に対してレビューを実施します
   - レビューした結果は `docs/{アプリ名}/{追加機能名}/review` に格納されいます
   - レビューは絶対に行われこの工程を独自の判断や時間の都合で飛ばすことはできません
   - レビューの結果不合格となった場合1からやり直します
     - ただし無限に繰り返されることを防ぐため繰り返しは3回までとします
---

カスタムエージェントとサブエージェントは下記のサイトを参考に構築を行います。
https://code.visualstudio.com/docs/copilot/agents/subagents
```

### 6-2.作成したカスタムエージェントを使用し開発計画を作成する

Agentモードから作成したカスタムエージェントに変更を行い下記のプロンプトを実行してみます。

```markdown
現在の機能に対して「サービス特有機能の有効/無効化機能」を追加します。
サービスが持つ機能はサービスマスタに紐づく形で管理され、テナントごとに有効/無効を切り替えることが可能です。
下記の仕様で動作します。

- 機能の有効化はサービスが利用可能なものしか設定できません
- 機能は単一のサービスに対して複数の設定が存在します
- 機能は有効/無効の設定を持ちます
- 現在はMockデータが構築されている為、同様にMockデータを構築する必要があります。
```
