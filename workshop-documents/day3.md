# GitHub Copilotを使用したAzureリソースの管理や問い合わせ対応などの運用サポート

0. 準備
1. IaCコードの分析
2. 既存AzureリソースからのIaCコードへの反映
3. azコマンドなどを利用したエラー情報の収集と分析（デモ）
4. azコマンドなどを利用したエラー情報を用いた開発計画の作成（一部デモ）
5. Actionsなどを利用した問い合わせ対応や調査作業の自動化（デモ）

## 0.準備

azコマンドを使用できるように`az login`を実施し
MS LearnのMCPサーバー利用できるか確認を行います。

## 1. IaCコードの分析

Bicepなどは都度更新がされているためMCPサーバーを利用しながら分析を実施したほうが良いです。
現在のIaCコードの内容をベースに人間が確認可能なドキュメントの情報に落とし込みを行っていきます。

```markdown
`infra`ディレクトリ内にあるIaCコードを参照し現在のAzure構成についてドキュメントを作成してください。
Azureのリソース間の連携については、AAやMermaidを使用して図を作成してください。
Bicepの機能やプロパティについては、最新のMS Learnの情報を参考にする必要があります。
```

## 2. 既存AzureリソースからのIaCコードへの反映

※空のディレクトリなどで実施したほうが安定すると思います
自分が内情を把握しているAzureリソースをターゲットにしたほうが良いかと思います。

```markdown
{リソースグループ(またはサブスクリプション)}のAzureリソースの情報をベースに下記の手順で作業を実施してください
**Azureのリソースは参照のみを行います。リソースの変更を行うのは禁止されています。**

1. 指定されたAzureリソースをターゲットにIaCコードを作成し`infra`ディレクトリに格納します
   - IaCコードを構築する際は常にMS Learnの最新の情報を参照にプロパティの情報を設定してください
2. 本番環境に影響がないようにBicepのコードをビルドし問題がないか確認します
3. IaCコードの解析を行いドキュメントを作成してください
   - Azureのリソース間の連携については、AAやMermaidを使用して図を作成してください。
```

### 3. azコマンドなどを利用したエラー情報の収集と分析（デモ）

エラーが発生しておりAzureのApplication Insightなどに情報が収集されている場合、その情報を参照、解析、改善の提案をCopilotで行うことが可能です。
すぐにエラーが発生している状態を用意できないと思うのでデモで利用するプロンプトを記載します（実行する必要はありません）
リソースの検討がついている場合は試すことが可能なので下記のプロンプトを実行してみてください。

```markdown
リソース{リソース名}で{発生日時}に発生したエラーの調査を行います。
azコマンドを使用しエラーの内容を解析してください。
```

### 4. azコマンドなどを利用したエラー情報を用いた開発計画の作成（一部デモ）

ソースコードが参照できる場合は修正の提案や計画まで構築することが可能です。
azコマンドで取得した想定のJSON情報を `day3-error-info.md` に格納しているため、その情報を利用し修正計画を構築してみます。

```markdown
Azure上でエラーが発生したためその内容を解析し修正計画の構築を行います。
**今回の対応は計画の作成までなので実装部分の変更は行いません**

1. `day3-error-info.md` にAzureから取得したエラー情報が格納されているためエラーの内容を解析します
2. エラー内容をもとに実装上問題となっている箇所を特定します
3. 修正計画を構築し文書として保存します
```

# 5. Actionsなどを利用した問い合わせ対応や調査作業の自動化（デモ）

今回実施した問い合わせの調査、計画作成、修正の流れを完全に自動化してみます。
各々の環境では試せる状態にないと思うのでデモのみです。
