# GitHub Copilotを使用したポリレポ構造アプリの開発

GitHub Copilotを使用してコードとドキュメントから下記の作業を実施します。

0. 事前準備
1. 作成されたドキュメントや仕様書から開発計画を作成する
2. 開発計画をもとにCoding AgentまたはAgentモードを使用して開発を実施する
3. Custom Agentを用いた開発の実施
4. SubAgentを用いたレビューを含む一気通貫の開発の実施

## 0. 事前準備

このリポジトリをCloneするかForkします。
Dockerが使用できる場合はDevContainerでコードを開き、Codespacesが使用できる場合はそこからコードを参照してみましょう。

`gh auth login` を使用してリポジトリを参照できるように設定します。

## 1. 作成されたドキュメントや仕様書から開発計画を作成する

Planモードを使用し開発計画を作成します。
先日の工程で作成された新機能追加のドキュメントが存在します(基本設計や詳細設計が終わった状態の想定です)のでそのドキュメントを使用します。
先日のワークショップに参加されていない方は `day2` ブランチに切り替えて実施します。

```markdown
`docs/{アプリ名}/{追加機能名}/Specs` に追加する機能についての情報が格納されています。
機能追加に必要な開発工程を構成したいです。開発プランを構築してください。
```

Planモードはいくつかの懸念事項を提示しながら仕様の深堀を行ってくれるはずです。
仕様の深堀が十分になったと判断できた時点でAgentモードに切り替え、下記のプロンプトを実行しましょう。

```markdown
構築されたプランをもとに開発計画を作成します。
開発者が開発しやすい粒度の単位に分割し`docs/{アプリ名}/{追加機能名}`に開発計画を作成してください。
開発の進捗管理用に下記のドキュメントの形式で作成します。開発タスクの中で参照すべきドキュメントがあればそのリンクを含めてください。

- 各タスク: `docs/{アプリ名}/{開発プラン名}/{開発順序}-{タスク名}.md`
- 進捗管理: `docs/{アプリ名}/{開発プラン名}/開発タスク.md`
```

## 2. 開発計画をもとにCoding AgentまたはAgentモードを使用して開発を実施する

作成された開発計画の一つをターゲットに実装を行います。
Agentモード、またはCoding Agentを利用します。

```markdown
`docs/{アプリ名}/{開発プラン名}/{開発順序}-{タスク名}.md`に記載された内容をもとに開発を行ってください。
```

## 3.Custom Agentを用いた開発の実施

単一の機能に特化したカスタムエージェントを構築して作業を実施してみます。
まずは下記プロンプトでカスタムエージェントを構築してみます。

```markdown
単体テストを実装することに特化したカスタムエージェントを構築します。
下記のように動作します。

- 実装された機能をもとに単体テストの計画を構築し実装を行います
  - バックエンドはPyTest、フロントエンドはJestを使用してテストが構成されます
- 構築するのはテストなので実際に動作するアプリ側の実装を編集することは厳禁です
- テストの実装後は実装を行いテストが通るまで実装を繰り返します
- テストはISTQBで定義されているテスト要求に従います
- テストは各サービスで展開されているリポジトリ内で実装される必要があります
- テスト実行後はテストレポートを作成し `docs/{アプリ名}/{開発プラン名}/{テスト日時}-単体テストレポート.md`として格納します

カスタムエージェントの構築は下記のプラクティスなどを参考に日本語で構築してください

- https://docs.github.com/en/copilot/concepts/agents/coding-agent/about-custom-agents?utm_source=changelog-docs-custom-agents&utm_medium=changelog&utm_campaign=universe25
- https://github.blog/ai-and-ml/github-copilot/how-to-write-a-great-agents-md-lessons-from-over-2500-repositories/
```

作成されたカスタムエージェントを利用しテストの実装を行います。
Agentモードを作成したカスタムエージェントに変更し下記プロンプトを実行しましょう。

```markdown
フロントエンドのテストを構築してください
```

## 4. SubAgentを用いたレビューを含む一気通貫の開発の実施

一度作成されたものを削除し、開発計画の作成～単体テストの実装まで一気通貫して開発を実施するためのエージェントを構築してみます。
エージェントは各工程の作業を実施するサブエージェントとそれを統括するオーケストレータエージェントの構成となります。
まずはカスタムエージェントを構築します。

```markdown
開発タスクの作成から単体テストの構築まで一気通貫で実施するカスタムエージェントを構築します。
エージェントは下記の手順で作業を実施します。

1. 開発タスクを作成します
   - 提示された情報源やプロンプトの情報をもとに開発タスクを構築します
   - 開発タスクはそれぞれ完了条件が存在しエージェントの作業内で確認可能な粒度で作成されます
     - 各タスク: `docs/{アプリ名}/{開発プラン名}/{開発順序}-{タスク名}.md`
   - 開発タスクの進捗を管理するための開発タスクリストが作成されます。このエージェントで作業される単位で開発タスクリストは作成されます。
     - 進捗管理: `docs/{アプリ名}/{開発プラン名}/開発タスク.md`
2. 開発の実装を行います。開発タスクで構成された各作業が下記の手順で実施されます。実装のビルドと単体テストがパスするまで繰り返されます。各工程の終了時に開発タスクを更新します。
   1. 開発タスクに記載された開発の実装
   2. 構築された実装のレビューと修復
   3. 単体テストの計画
   4. 構築された計画のレビューと修復
3. 統合とレポートの提出
   - アプリケーション全体を確認し整合性が取れていないところがないか確認を行います
   - 全体のテストとビルドを実行しエラーが発生している場合は修復します
   - 結果のレポートを`docs/{アプリ名}/{開発プラン名}/作業結果.md` に格納します。

カスタムエージェントとサブエージェントは下記のサイトを参考に構築を行います。
https://code.visualstudio.com/docs/copilot/agents/subagents
```

作成されたサブエージェントを利用して開発を行います。Agentモードから構築したオーケストレーションエージェントに変更を行い開発を行ってもらいましょう。
この実装フェーズはおそらく時間内に終わりません。

```markdown
`docs/{アプリ名}/{開発プラン名}`の機能を実装してください。
```
